<html color-mode="user" lang="fr">
  <head>
    <base href='/fr' />
    <!-- ga -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DQVD9T27V4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DQVD9T27V4');
    </script>

    <!-- deps -->
    <script type="module" src="/assets/js/turbo.es2017-esm.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.fuchsia.min.css"
    >

    <!-- defaults -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark" />

    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- meta -->
    <title>Les Développeurs Médiocres Craignent Mongo et Vénèrent le RDBMS</title>

    <meta property="og:title" content="Les Développeurs Médiocres Craignent Mongo et Vénèrent le RDBMS"/>
    <meta property="og:description" content="passez votre chemin." />
    <meta property="og:image" content="https://drawohara.io/media/mick.jpg" />

    <meta property="og:image:type" content="image/jpeg" />

    <meta property="site:route" content=""/dojo4/archive/:id"">
    <meta property="site:params" content="{"ext":null,"id":"les-developpeurs-mediocres-craignent-mongo-et-venerent-le-rdbms"}">
    <meta property="site:path_info" content=""/les-developpeurs-mediocres-craignent-mongo-et-venerent-le-rdbms"">

    <style>
      /* anti pico */
      a {text-decoration: none !important; }

      /* anti turbo */
      html { transition: none !important; }
      .turbo-progress-bar { visibility: hidden; }

      /* anti progressive */
      html { margin: 1em; }
      img { display: block; text-align: center; }
    </style>

    <script>
      document.addEventListener("turbo:load", function() {
        const progressBar = document.querySelector('.turbo-progress-bar');
        if (progressBar) {
          progressBar.remove();
        }
      });
    </script>
  </head>

  <body>
    <header>
      <a href="/accueil">@drawohara</a>
      <hr>
    </header>

    <main>
      <div class="ro markdown">
        <h3 id="tl-dr">TL; DR;</h3>

        <blockquote>
          <p>99,9 % des développeurs web pensent que l'utilisation correcte d'un RDBMS, ainsi que des transactions, empêche leurs applications de voir des données incorrectes et d'introduire des erreurs graves de qualité des données. Ils ont <em>TOTALEMENT TORT</em>.</p>
        </blockquote>

        <p>J'ai lu avec grand intérêt l'excellent article de <a href="https://github.com/aphyr">Kyle Kingsbury</a> sur le modèle de cohérence de Mongo à l'adresse https://aphyr.com/posts/322-call-me-maybe-mongodb-stale-reads</p>

        <p>Évidemment, ce type est très compétent et connaît son sujet. Il fait le travail et tout dans cet article est perspicace et bien élaboré.</p>

        <p>Ce que j'ai trouvé stupéfiant, cependant, ce sont les commentaires et ce qu'ils révèlent sur le développeur professionnel moyen :</p>

        <blockquote>
          <p>Les développeurs pensent que l'utilisation d'un RDBMS rend leurs données sûres et ils ont <em>complètement tort</em></p>
        </blockquote>

        <p>Je ne peux pas vous dire combien de fois je me suis disputé avec des développeurs "professionnels" et surtout des administrateurs système idiots qui croient vraiment que, simplement en disant le mot RDBMS, en faisant tourner un poulet autour de leur tête 3 fois, et en se connectant à la licorne magique des bases de données, leurs données seront en sécurité et à l'abri comme, vous savez, ... (quelque chose quelque chose à propos de) ... les transactions bancaires et tout ce (non-sens) de transactions et de fsync. Et plein d'autres choses qu'aucun développeur que j'ai rencontré n'a jamais vraiment compris ou considéré dans le contexte d'une application HTTP (indice : sans état).</p>

        <p>Avant de continuer, je vais lancer un défi :</p>

        <ul>
          <li>Envoyez-moi votre identifiant GitHub</li>
          <li>Laissez-moi choisir une application que vous avez écrite avec MySQL ou PostgreSQL (pour que vous ne puissiez pas la préparer)</li>
          <li>Et je trouverai des chemins de code qui fournissent à la fois des lectures non validées et des lectures sales dans votre application en 1 jour</li>
          <li>S'il n'y en a pas, je vous paierai <em>1000 dollars</em></li>
          <li>S'il y en a, je pourrai publier une photo de vous de mon choix en annexe à cet article. Photoshop <em>est</em> autorisé.</li>
        </ul>

        <p>Trouvez-moi à <a href="/contact">/contact</a> ou <a href="/equipe/ara-t-howard">/equipe/ara-t-howard</a>. Maintenant, continuons…</p>

        <p>Développeur, devine ce qui ne va pas avec ce chemin de code :</p>

        <div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>
        </div><div class='code-line code-line-2'>&nbsp;&nbsp;<span style="color: #0550ae">@db</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">transaction</span>&nbsp;<span style="color: #cf222e">do</span>
        </div><div class='code-line code-line-3'>
        </div><div class='code-line code-line-4'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">no_user_exists_with_conditions?</span>
        </div><div class='code-line code-line-5'>
        </div><div class='code-line code-line-6'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@user</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">make_that_user_exists_with_those_conditions!</span>
        </div><div class='code-line code-line-7'>
        </div><div class='code-line code-line-8'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">deliver_an_activation_email_to!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">@user</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
        </div><div class='code-line code-line-9'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
        </div><div class='code-line code-line-10'>
        </div><div class='code-line code-line-11'>&nbsp;&nbsp;<span style="color: #cf222e">end</span>
        </div><div class='code-line code-line-12'>
        </div><div class='code-line code-line-13'>
        </div></code></div>

        <p>Laissez-moi vous révéler quelque chose de renversant :</p>

        <p><strong>CE CODE EST COMPLÈTEMENT CASSÉ SUR TOUTES LES PRINCIPALES <em>RDBMS</em>, ET VIRTUELLEMENT TOUTES<br />
        LES APPLICATIONS, DANS LE MONDE</strong></p>

        <p>Je vous assure que l'email sortira <em>deux fois</em>.</p>

        <p>Expliquer les transactions dépasse le cadre de cet article, mais laissez-moi vous présenter les "lectures fantômes"</p>

        <p>http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Phantom_reads</p>

        <p>Dans le code ci-dessus, une 2ème transaction concurrente peut entraîner ce qui suit :</p>

        <div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>
        </div><div class='code-line code-line-2'>&nbsp;&nbsp;<span style="color: #0550ae">@db</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">transaction</span>&nbsp;<span style="color: #cf222e">do</span>
        </div><div class='code-line code-line-3'>
        </div><div class='code-line code-line-4'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">no_user_exists_with_conditions?</span>
        </div><div class='code-line code-line-5'>
        </div><div class='code-line code-line-6'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># pendant ce temps, une 2ème transaction a créé un utilisateur en double...</span>
        </div><div class='code-line code-line-7'>
        </div><div class='code-line code-line-8'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># ce qui suit réussira, dans __les deux__ transactions</span>
        </div><div class='code-line code-line-9'>
        </div><div class='code-line code-line-10'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@user</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">make_that_user_exists_with_those_conditions!</span>
        </div><div class='code-line code-line-11'>
        </div><div class='code-line code-line-12'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># les deux transactions enverront l'email</span>
        </div><div class='code-line code-line-13'>
        </div><div class='code-line code-line-14'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">deliver_an_activation_email_to!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">@user</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
        </div><div class='code-line code-line-15'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
        </div><div class='code-line code-line-16'>
        </div><div class='code-line code-line-17'>&nbsp;&nbsp;<span style="color: #cf222e">end</span>
        </div><div class='code-line code-line-18'>
        </div><div class='code-line code-line-19'>&nbsp;&nbsp;<span style="color: #6e7781"># une des transactions échouera à valider, et fera *BOOM* mais, à ce moment-là,</span>
        </div><div class='code-line code-line-20'>&nbsp;&nbsp;<span style="color: #6e7781"># il est trop tard : l'email a été envoyé deux fois et l'erreur a été commise</span>
        </div><div class='code-line code-line-21'>
        </div><div class='code-line code-line-22'>
        </div></code></div>

        <p>Je sais, je sais, vous ne pouvez pas le croire. Mais c'est juste parce que vous n'avez jamais pris la peine de lire le manuel lorsqu'il s'agit de ce que "transaction" signifie. Commencez ici :</p>

        <p>http://www.postgresql.org/docs/9.1/static/transaction-iso.html</p>

        <p>Notez ce petit tableau. Laissez-moi vous le traduire :</p>

        <ul>
          <li>
            <p>Parce que <em>vous</em> n'avez pas chaque <em>séquence unique</em> de <em>lecture et écriture</em> enveloppée dans une transaction, et que parfois vous lancez simplement du code contre vos objets ORM directement, vous souffrez de la réalité "effrayante" de la "lecture non validée" mentionnée dans l'article</p>
          </li>
          <li>
            <p>Parce que <em>vous</em> vous fiez au niveau d'isolement par défaut, vous souffrez à la fois des lectures non répétables et des lectures fantômes. (Savez-vous même ce qu'est l'isolement par défaut pour votre base de données et ce que cela signifie ????)</p>
          </li>
          <li>
            <p>Parce que <em>vous</em> n'avez pas défini votre niveau de transaction sur "sérialisable", vous croyez à tort que votre base de données est rapide et sûre. Vous avez compté à tort sur la base de données pour fournir l'intégrité des données comme une abstraction qui ne nécessite pas de réflexion critique et un code d'application au moins 10 fois meilleur que le vôtre. Vous avez toutes les caractéristiques effrayantes de l'article de Kyle dans vos applications basées sur RDBMS - et, non seulement vous <em>ne le savez pas</em>, mais vous êtes <em>plutôt sûr que vos données sont "sûres"</em></p>
          </li>
        </ul>

        <p>Je vous demande donc quelle est la pire décision d'ingénierie :</p>

        <ul>
          <li>
            <p>Choisir un outil basé sur des normes que tout le monde est <em>très</em> confiant de comprendre et de savoir utiliser en toute sécurité mais qui, dans son utilisation courante, ne garantit presque jamais ce qu'il promet et, en outre, a été largement <a href="http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Default_isolation_level">critiqué comme ayant des sémantiques ambiguës et inexactes</a> ?</p>
          </li>
          <li>
            <p>Ou accepter ce qui a toujours été vrai : qu'en eux-mêmes, les bases de données ne peuvent pas fournir des abstractions qui signifient que les développeurs non extrêmement intelligents ne peuvent pas facilement tout gâcher. Et que l'intégrité des données est un concept spécifique au domaine qui doit être implémenté au niveau de l'application, avec seulement une petite partie de cette intégrité étant aidée par le choix de la base de données.</p>
          </li>
        </ul>

        <p>ps. J'ai travaillé sur des systèmes financiers, en temps réel et à haute disponibilité de grande envergure qui utilisent à la fois Mongo et PostgreSQL. C'est sacrément difficile dans les deux cas.</p>

        <p>pss. J'ai essayé de commenter sur votre blog Kyle, mais les commentaires explosaient ;-)</p>

        <p><img src="https://s3.amazonaws.com/ss.dojo4.com/JKeSPdp46a4R3paZkp6oo7X1b7QNhI6hQN4kp1QPx3ZYqn3exRzqht0.png" style="max-width:200px;" /></p>

      </div>
    </main>

    <footer>
      <hr>
      <a href="/goto" name="goto">&mdash;&gt; goto</a>
      <blockquote>
        <ul>
          <li>
            <a href="/a-propos">a-propos<a>
          </li>
          <li>
            <a href="mailto:je-deteste-ca@drawohara.io?subject=/les-developpeurs-mediocres-craignent-mongo-et-venerent-le-rdbms">je-deteste-ca<a>
          </li>
          <li>
            <a href="mailto:j-adore-ca@drawohara.io?subject=/les-developpeurs-mediocres-craignent-mongo-et-venerent-le-rdbms">j-adore-ca<a>
          </li>
          <li>
            <a href="/contact">contact<a>
          </li>
        </ul>
      </blockquote>
      <a href="/">&lt;&mdash; eject</a>
    </footer>
  </body>
</html>