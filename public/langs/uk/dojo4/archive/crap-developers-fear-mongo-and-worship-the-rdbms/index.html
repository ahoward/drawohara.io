<html color-mode="user" lang="uk">
  <head>
  <!-- ga -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DQVD9T27V4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DQVD9T27V4');
</script>

  <!-- deps -->
    <script type="module" src="/assets/js/turbo.es2017-esm.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.fuchsia.min.css"
    >

  <!-- langs -->
  <!--
    https://developers.google.com/search/docs/specialty/international/localized-versions#html
  -->
   <link rel="alternate" hreflang="en" href="/" />
   <link rel="alternate" hreflang="uk" href="https://drawohara.io/langs/uk" />
   <link rel="alternate" hreflang="sv" href="https://drawohara.io/langs/sv" />
   <link rel="alternate" hreflang="fr" href="https://drawohara.io/langs/fr" />
   <link rel="alternate" hreflang="es" href="https://drawohara.io/langs/es" />
   <link rel="alternate" hreflang="it" href="https://drawohara.io/langs/it" />

  <!-- defaults -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark" />

  <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

  <!-- meta -->
    <title>тут нічого немає.</title>

<meta property="og:title" content="тут нічого немає."/>
<meta property="og:description" content="продовжуйте йти." />
<meta property="og:image" content="https://drawohara.io/media/mick.jpg" />

<meta property="og:image:type" content="image/jpeg" />

    <meta property="site:route" content=""/dojo4/archive/:id"">
    <meta property="site:params" content="{"ext":null,"id":"crap-developers-fear-mongo-and-worship-the-rdbms"}">
    <meta property="site:path_info" content=""/crap-developers-fear-mongo-and-worship-the-rdbms"">

    <style>
      /* anti pico */
      a {text-decoration: none !important; }

      /* anti turbo */
      html { transition: none !important; }
      .turbo-progress-bar { visibility: hidden; }

      /* anti progressive */
      html { margin: 1em; }
      img { display: block; text-align: center; }
    </style>

    <script>
      document.addEventListener("turbo:load", function() {
        const progressBar = document.querySelector('.turbo-progress-bar');
        if (progressBar) { progressBar.remove(); }
      });
    </script>
    <base href='/langs/uk' />
  </head>

  <body>
    <header>
      <a href="/home">@drawohara</a> &mdash;
<a href="mailto:i-love-this@drawohara.io?subject=/crap-developers-fear-mongo-and-worship-the-rdbms">я ❤️ це!</a>
<hr>
<strong>/crap-developers-fear-mongo-and-worship-the-rdbms</strong>
    </header>

    <main>
      <em>опубліковано: 2015-04-22</em>
<br>
<br>
<div class="ro markdown">
  <h3 id="tl-dr">TL; DR;</h3>

<blockquote>
  <p>99.9% світу веб-розробників вважають, що правильне використання РСКБД разом із транзакціями запобігає появі поганих даних та серйозних помилок якості даних у їхніх застосунках. Вони <em>АБСОЛЮТНО НЕПРАВІ</em>.</p>
</blockquote>

<p>З великим інтересом я прочитав чудову статтю <a href="https://github.com/aphyr">Кайла Кінґсбері</a> про модель консистенції Mongo на <a href="https://aphyr.com/posts/322-call-me-maybe-mongodb-stale-reads" target="_blank">https://aphyr.com/posts/322-call-me-maybe-mongodb-stale-reads</a></p>

<p>Очевидно, що цей хлопець дуже розумний та знає свою справу. Він виконує роботу, і все в цій статті є цікавим та добре складеним.</p>

<p>Але мене здивували коментарі та те, що вони розповідають про середнього професійного розробника:</p>

<blockquote>
  <p>Розробники вважають, що використання РСКБД робить їхні дані безпечними, і вони <em>абсолютно неправі</em></p>
</blockquote>

<p>Я не можу сказати, скільки разів я вступав у суперечки з "професійними" розробниками та особливо дурними сисадмінами, які справді вірять, що, просто сказавши слово "РСКБД", обернувши курку три рази навколо голови та підключившись до магічного єдинорога БД, їхні дані будуть безпечні та надійні, як, знаєте, ... (щось-щось про) ... банківські транзакції та вся ця (нісенітниця) бовтанка про транзакції та fsync. І ціла купа інших речей, які жоден розробник, з яким я коли-небудь зустрічався, не розуміє чи не розглядає в контексті HTTP-застосунку (підказка: безстанного).</p>

<p>Перш ніж продовжити, я викину виклик:</p>

<ul>
  <li>Надішліть мені свій обліковий запис GitHub</li>
  <li>Дозвольте мені вибрати додаток, який працює на MySQL або PostgreSQL, який ви написали (щоб ви не могли підготувати його)</li>
  <li>І я знайду шляхи коду, які забезпечують як читання непідтверджених, так і брудні читання у вашому додатку протягом 1 дня</li>
  <li>Якщо їх немає, я заплачу вам <em>1000 баксів</em></li>
  <li>Якщо вони є, я зможу розмістити будь-яке зображення, яке я оберу, як додаток до цієї статті. Фотошоп <em>дозволено</em>.</li>
</ul>

<p>Знайдіть мене на <a href="/contact">/contact</a> або <a href="/team/ara-t-howard">/team/ara-t-howard</a>. Тепер продовжуймо...</p>

<p>Розгадайте мені це, розробник: що не так з цим шляхом коду:</p>

<div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>
</div><div class='code-line code-line-2'>&nbsp;&nbsp;<span style="color: #0550ae">@db</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">transaction</span>&nbsp;<span style="color: #cf222e">do</span>
</div><div class='code-line code-line-3'>
</div><div class='code-line code-line-4'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">no_user_exists_with_conditions?</span>
</div><div class='code-line code-line-5'>
</div><div class='code-line code-line-6'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@user</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">make_that_user_exists_with_those_conditions!</span>
</div><div class='code-line code-line-7'>
</div><div class='code-line code-line-8'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">deliver_an_activation_email_to!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">@user</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-9'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-10'>
</div><div class='code-line code-line-11'>&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-12'>
</div><div class='code-line code-line-13'>
</div></code></div>

<p>Дозвольте мені розповісти вам щось, що зруйнує ваш світ:</p>

<p><strong>ЦЕЙ КОД АБСОЛЮТНО ЗЛАМАНИЙ НА ВСІХ ОСНОВНИХ <em>РСКБД</em> ТА ВІРТУАЛЬНО ВСИХ<br />
ЗАСТОСУНКАХ У СВІТІ</strong></p>

<p>Я запевняю вас, що електронний лист вийде <em>двічі</em>.</p>

<p>Пояснення транзакцій виходить за межі цієї статті, але дозвольте мені представити вам "фантомні читання".</p>

<p><a href="http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Phantom_reads" target="_blank">http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Phantom_reads</a></p>

<p>У наведеному вище коді друга, паралельна транзакція може спричинити наступне:</p>

<div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>
</div><div class='code-line code-line-2'>&nbsp;&nbsp;<span style="color: #0550ae">@db</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">transaction</span>&nbsp;<span style="color: #cf222e">do</span>
</div><div class='code-line code-line-3'>
</div><div class='code-line code-line-4'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">no_user_exists_with_conditions?</span>
</div><div class='code-line code-line-5'>
</div><div class='code-line code-line-6'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># тим часом, друга транзакція створила дубльованого користувача...</span>
</div><div class='code-line code-line-7'>
</div><div class='code-line code-line-8'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># наступне буде успішним у <em>обидвих</em> транзакціях</span>
</div><div class='code-line code-line-9'>
</div><div class='code-line code-line-10'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@user</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">make_that_user_exists_with_those_conditions!</span>
</div><div class='code-line code-line-11'>
</div><div class='code-line code-line-12'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># обидві транзакції відправлять лист</span>
</div><div class='code-line code-line-13'>
</div><div class='code-line code-line-14'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">deliver_an_activation_email_to!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">@user</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-15'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-16'>
</div><div class='code-line code-line-17'>&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-18'>
</div><div class='code-line code-line-19'>&nbsp;&nbsp;<span style="color: #6e7781"># одна з транзакцій не вдасться та вибухне, але до того часу,</span>
</div><div class='code-line code-line-20'>&nbsp;&nbsp;<span style="color: #6e7781"># буде запізніло: лист відправлено двічі, а помилка вже зроблена</span>
</div><div class='code-line code-line-21'>
</div><div class='code-line code-line-22'>
</div></code></div>

<p>Я знаю, я знаю, ви не можете в це повірити. Але це лише тому, що ви ніколи не держалися RTFM, коли йде мова про те, що означає "транзакція". Почніть тут:</p>

<p><a href="http://www.postgresql.org/docs/9.1/static/transaction-iso.html" target="_blank">http://www.postgresql.org/docs/9.1/static/transaction-iso.html</a></p>

<p>Зверніть увагу на цю маленьку таблицю. Дозвольте мені перекласти її для вас:</p>

<ul>
  <li>
    <p>Тому що <em>ви</em> не маєте кожну <em>окрему</em> послідовність <em>читання та запису</em>, обгорнуту транзакцією, і іноді просто кидаєте код проти ваших ORM-об'єктів безпосередньо, ви страждаєте від "страшної" реальності "читання непідтверджених", згаданої в статті</p>
  </li>
  <li>
    <p>Тому що <em>ви</em> покладаєтесь на рівень ізоляції за замовчуванням, ви страждаєте як від неповторюваних читань, так і від фантомних читань. ( Chi ви навіть знаєте, що таке рівень ізоляції за замовчуванням для вашої бази даних і що це означає????)</p>
  </li>
  <li>
    <p>Тому що <em>ви</em> не встановили свій рівень транзакції на "послідовний", ви помилково вважаєте, що ваша база даних швидка та безпечна. Ви неправильно покладалися на базу даних для забезпечення цілісності даних як абстракцію, яка не вимагає критичного мислення та коду застосунку принаймні в 10 разів кращого за ваш. У вас є всі страшні функції зі статті Кайла в додатках, що працюють на РСКБД - і, не лише ви <em>не знаєте це</em>, ви <em>впевнені, що ваші дані "безпечні"</em></p>
  </li>
</ul>

<p>І тому я запитую вас, яке рішення гірше з точки зору інженерії:</p>

<ul>
  <li>
    <p>Вибрати інструмент на основі стандартів, в якому всі <em>дуже</em> впевнені, що розуміють і знають, як безпечно використовувати, але в його звичайному використанні він майже ніколи не гарантує те, що він, на вашу думку, обіцяє, і крім того, його широко <a href="http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Default_isolation_level">критикують за неоднозначні та неточні семантики</a> ?</p>
  </li>
  <li>
    <p>Чи прийняти те, що завжди було правдою: що бази даних самі по собі не можуть забезпечити абстракції, які означають, що не надзвичайно розумні розробники не можуть тривіально все зіпсувати. І що цілісність даних - це специфічна для домену концепція, яка повинна бути реалізована на рівні застосунку, при цьому лише невелика частина цієї цілісності покращується вибором бази даних.</p>
  </li>
</ul>

<p>п.с. Я працював над великомасштабними фінансовими, реальночасовими та високодоступними системами, які використовують як Mongo, так і PostgreSQL. Це надзвичайно важко в будь-якому випадку.</p>

<p>п.п.с. Я намагався прокоментувати ваш блог, Кайл, але коментарі вибухнули ;-)</p>

<p><img src="https://s3.amazonaws.com/ss.dojo4.com/JKeSPdp46a4R3paZkp6oo7X1b7QNhI6hQN4kp1QPx3ZYqn3exRzqht0.png" style="max-width:200px;" /></p>

</div>
    </main>

    <footer>
      <hr>
<a href="/goto" name="goto">&mdash;&gt; goto</a>
<blockquote>
<ul>
  <li>
    <a href="mailto:i-hate-this@drawohara.io?subject=/crap-developers-fear-mongo-and-worship-the-rdbms">😩, я 🖤 ^це!<a>
  </li>
  <li>
    <a href="/now">/now<a>
  </li>
  <li>
    <a href="/about">/about<a>
  </li>
  <li>
    <a href="/contact">/contact<a>
  </li>
  <li>
    <a href='/langs' id='lang'>🌎</a>
  </li>
</ul>
</blockquote>
<a href="/">&lt;&mdash; eject</a>
    </footer>
  </body>
</html>