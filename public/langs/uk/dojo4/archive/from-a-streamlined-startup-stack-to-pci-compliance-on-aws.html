<html color-mode="user" lang="uk">
  <head>
  <base href='/uk' />
  <!-- ga -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DQVD9T27V4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DQVD9T27V4');
</script>

  <!-- deps -->
    <script type="module" src="/assets/js/turbo.es2017-esm.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.fuchsia.min.css"
    >

  <!-- defaults -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark" />

  <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x32.png">
    <link rel="manifest" href="/site.webmanifest">

  <!-- meta -->
    <title>Від простого стартап-стеку до відповідності PCI на AWS</title>

<meta property="og:title" content="Від простого стартап-стеку до відповідності PCI на AWS"/>
<meta property="og:description" content="переходьте далі." />
<meta property="og:image" content="https://drawohara.io/media/mick.jpg" />


  <meta property="og:image:type" content="image/jpeg" />

    <meta property="site:route" content=""/uk/dojo4/archive/:id"">
    <meta property="site:params" content="{"ext":null,"id":"from-a-streamlined-startup-stack-to-pci-compliance-on-aws"}">
    <meta property="site:path_info" content=""/from-a-streamlined-startup-stack-to-pci-compliance-on-aws"">

    <style>
      /* anti pico */
      a {text-decoration: none !important; }

      /* anti turbo */
      html { transition: none !important; }
      .turbo-progress-bar { visibility: hidden; }

      /* anti progressive */
      html { margin: 1em; }
      img { display: block; text-align: center; }
    </style>

    <script>
      document.addEventListener("turbo:load", function() {
        const progressBar = document.querySelector('.turbo-progress-bar');
        if (progressBar) {
          progressBar.remove();
        }
      });
    </script>
  </head>

  <body>
    <header>
      <a href="/uk/home">@drawohara</a>
<hr>
    </header>

    <main>
      <div class="ro markdown">
  <h2 id="vstup">Вступ</h2>

<p>Працюючи над проєктами в <a href="http://dojo4.com">Dojo4</a> я часто здивований тим, як нікчемні здавалося б збільшення технічної складності <a href="http://uk.wikipedia.org/wiki/Комбінаторний_вибух">перетворюються</a> на значні проблеми з увагою та ресурсами. Внаслідок цього, коли проєкти тільки починаються, ми схиляємося до використання спрощеного хостингу та стеку додатків, який має багато спільних рис з поділеними хостинг-послугами. Це включає такі рішення, як хостинг додатку та бази даних разом, використання одного користувача для розгортання на хостинг-системі та простий <a href="http://uptimerobot.com">моніторинг часу роботи</a>.</p>

<p>Нещодавно наш давній клієнт, <a href="http://www.inspirecommerce.com/">Inspire Commerce</a>, розробив новий бізнес-план, який вимагає, щоб їх додаток відповідав суворим вимогам <a href="https://www.pcisecuritystandards.org/">Індустрії платіжних карток</a> (PCI) рівня 1 безпеки для обробки, передачі та зберігання інформації про кредитні картки. Багато вимог безпеки, викладених у стандарті безпеки даних PCI (DSS), спонукають до значних змін у мисленні від згаданого вище спрощеного фокусованого стеку. Цей пост коротко перерахує деякі з цих деталей та накреслить наші рішення.</p>

<p>Стандарт PCI DSS складається з 12 розділів, які охоплюють все від налаштування брандмауерів до політик безпеки персоналу. Я коротко розгляну декілька розділів, які стосуються хостинг-стеку.</p>

<h2 id="1-встановити-і-підтримувати-конфігурацію-брандмауеру-для-захисту-даних-власників-карток">1. Встановити і підтримувати конфігурацію брандмауеру для захисту даних власників карт</h2>

<p>Це досить детальний розділ DSS, який вимагає встановлення та налаштування <a href="http://uk.wikipedia.org/wiki/Брандмауер_(мережева_безпека)">брандмауерів</a> на всіх мережевих пристроях, від робочих станцій до маршрутизаторів та серверів. Використовуючи <a href="http://aws.amazon.com/">Amazon Web Services</a> (AWS) <a href="http://aws.amazon.com/ec2/">Elastic Compute Cloud</a> (EC2) як основу нашого хостинг-стеку, багато цих мережевих пристроїв або абстраговані з нашого поля зору, або контролю. Зручно те, що <a href="http://aws.amazon.com/security/#certifications">AWS сам відповідає стандарту PCI Level 1</a>, залишаючи багато цих деталей інженерам Amazon.</p>

<p>Однак брандмауери для вузлів EC2 вимагають деяких розглядів. Вузли EC2 захищені брандмауером, реалізованим на рівні <a href="www.xen.org/products/xenhyp.html">гіпервізора</a> та налаштованим групами безпеки AWS. Наша базова група безпеки забороняє всі порти, крім 22, 80 та 443, які приймають з усіх джерел. Ми використовуємо <a href="www.ubuntu.com/">Ubuntu Linux</a> на наших вузлах, і з коробки у нас налаштований <a href="www.netfilter.org/projects/iptables/">IP Tables</a> брандмауер з відкритою політикою.</p>

<p>PCI DSS зосереджується на використанні брандмауерів для створення безпечних приватних мереж або <a href="http://uk.wikipedia.org/wiki/Демілітаризована_зона">демілітаризованих зон</a> (DMZ) для систем, які обслуговують додатки, які обробляють дані платіжних карт. Групи безпеки AWS забезпечують корисний механізм для створення безпечних приватних мереж між різними компонентами стеку додатків. Наприклад, створюючи WEB-групу безпеки та DB-групу безпеки та відкриваючи порт бази даних у DB-групі безпеки лише для джерел WEB-групи безпеки, брандмауер гіпервізора EC2, що працює на сервері бази даних, дозволить доступ до бази даних лише з веб-серверів, підключених до внутрішнього приватного мережевого інтерфейсу.</p>

<p>Для забезпечення відмовної стійкості ми віддзеркалюємо конфігурацію групи безпеки AWS для гіпервізора брандмауера EC2 з <a href="http://www.cloudpassage.com/">CloudPassage</a> сервісом, який здатний керувати брандмауером IP Tables на рівні операційної системи систем, які обслуговують компоненти додатку для обробки карт. CloudPassage організовує політики брандмауерів у <a href="http://www.cloudpassage.com/features/halo-firewall.html">Server Groups</a>, які дещо аналогічні групам безпеки AWS. Ще однією чудовою функцією CloudPassage є <a href="http://www.cloudpassage.com/features/multifactor-authentication.html">GhostPorts</a> сервіс. Ми налаштовуємо політику ssh-порту в CloudPassage для приймання з'єднань з джерел GhostPort. Щоб клієнтська машина стала джерелом GhostPort, користувач на цій машині повинен авторизуватися в порталі CloudPassage, бути уповноваженим відкривати GhostPorts для групи серверів та авторизуватися з зареєстрованим Yubikey-ключем або відповісти на SMS-виклик зареєстрованим мобільним телефоном. Після успішної автентифікації та авторизації CloudPassage налаштовує IP Tables для приймання з'єднань з IP-адреси джерела клієнтської машини. Це зручний, безпечний, тимчасовий та аудитований спосіб керування доступом до чутливих хостів.</p>

<h2 id="2-не-використовувати-параметри-за-замовчуванням-постачальника-для-системних-паролів-та-інших-параметрів-безпеки">2. Не використовувати параметри за замовчуванням постачальника для системних паролів та інших параметрів безпеки</h2>

<p>Цей розділ здається досить очевидним. Хорошим прикладом важливості зміни пароля за замовчуванням постачальника є <a href="http://www.splunk.com/">Splunk</a> <a href="http://docs.splunk.com/Documentation/Splunk/latest/Deploy/Introducingtheuniversalforwarder">Universal Forwarder</a> за замовчуванням пароль changeme.</p>

<p>Однак, у цьому розділі захований важливий вимога до хостингу, яка частково не пов'язана з назвою розділу. "2.2.1 Реалізуйте лише одну основну функцію на сервері, щоб запобігти співіснуванню функцій, які вимагають різних рівнів безпеки, на одному сервері. (Наприклад, веб-сервери, сервери баз даних та DNS повинні реалізовуватися на окремих серверах)."</p>

<p>Як згадувалося вище, групи безпеки AWS полегшують завдання безпечного розділення послуг, таких як веб-сервери та сервери баз даних, на окремі хости.</p>

<h2 id="5-використовувати-та-регулярно-оновлювати-антивірусне-програмне-забезпечення">5. Використовувати та регулярно оновлювати антивірусне програмне забезпечення</h2>

<p><a href="http://clamav.com">ClamAV</a> швидко справляється з цією вимогою на Ubuntu Linux.</p>

<h2 id="8-призначити-унікальний-ідентифікатор-кожній-особі-з-доступом-до-компютера">8. Призначити унікальний ідентифікатор кожній особі з доступом до комп'ютера</h2>

<p>Мета цього розділу - полегшити аудит та відповідальність шляхом видалення спільних користувацьких облікових записів. Оскільки ми використовуємо <a href="http://uk.wikipedia.org/wiki/Ssh-keygen">ключовий механізм аутентифікації</a> для <a href="http://uk.wikipedia.org/wiki/Secure_Shell">безпечного доступу до оболонки</a>, існує три основні питання щодо того, хто що зробив. По-перше, необхідно запобігти можливості користувача перемикатися на інший обліковий запис користувача за допомогою команди <a href="http://uk.wikipedia.org/wiki/Su_%28Unix%29">su</a>. Це легко виконати, видаливши <a href="http://uk.wikipedia.org/wiki/Файлова_система#Traditional_Unix_permissions">права на виконання</a> на su-бінарник та змінивши <a href="http://aplawrence.com/Basics/understandingpam.html">/etc/pam.d</a> запобігти всім su-авторизаціям. По-друге, переконайтеся, що файли <a href="http://www.eng.cam.ac.uk/help/jpmg/ssh/authorized_keys_howto.html">authorized_keys</a> для всіх користувацьких облікових записів містять лише один запис. Нарешті, переконайтеся, що всі ключі, які використовуються для безпечного доступу до оболонки, захищені паролем, і що існує політика, яка забороняє спільне використання ключів між користувачами.</p>

<p>Тепер <a href="http://www.cyberciti.biz/tips/linux-audit-files-to-see-who-made-changes-to-a-file.html">Linux Audit Daemon</a> (AuditD) можна використовувати для відстеження системної активності конкретних користувачів.</p>

<h2 id="9-обмежити-фізичний-доступ-до-даних-власників-карток">9. Обмежити фізичний доступ до даних власників карт</h2>

<p>Назва цього розділу досить самоописна. Основно, цей розділ охоплює теми обмеження фізичного доступу до даних центрів для уповноваженого персоналу. Подібно до обговорення налаштування брандмауерів мережевих пристроїв вище, це охоплюється сертифікацією AWS PCI Level 1, і деталі можна залишити Amazon.</p>

<h2 id="10-відстежувати-та-моніторити-весь-доступ-до-мережевих-ресурсів-та-даних-власників-карток">10. відстежувати та моніторити весь доступ до мережевих ресурсів та даних власників карт</h2>

<p>Мотивація цього розділу - "запобігання, виявлення або мінімізація впливу компрометації даних". Це включає такі теми, як ведення журналів, керування цілісності файлів та виявлення вторгнень. Наша стратегія починається з використання сервісу ведення журналів для підтримки агрегації журналів, зберігання журналів, а також пошуку записів журналів. Ми використовуємо <a href="http://splunk.com">Splunk</a> додаток для цієї функціональності. Ми налаштували інстанс EC2 для серверу ведення журналів та встановили Splunk. Ми налаштували групи безпеки AWS та CloudPassage ServerGroups для нового сервера, який має порт прослуховувача Splunk, що приймає з'єднання з джерел веб-сервера та сервера бази даних на приватному мережевому інтерфейсі. Потім ми налаштували Splunk Universal Forwarder на веб-серверах та серверах баз даних та налаштували форвардери для моніторингу додаткових, apache, mongodb, sys, audit та auth журналів.</p>

<p>Для моніторингу цілісності файлів та виявлення вторгнень ми встановили <a href="http://www.ossec.net/?page_id=165">OSSEC</a> додаток на всіх наших серверах та додали всі журнали, які пише OSSEC, до форвардерів Splunk.</p>

</div>
    </main>

    <footer>
      <hr>
<a href="/uk/goto" name="goto">&mdash;&gt; goto</a>
<blockquote>
<ul>
  <li>
    <a href="/uk/about">про нас<a>
  </li>
  <li>
    <a href="mailto:i-hate-this@drawohara.io?subject=/from-a-streamlined-startup-stack-to-pci-compliance-on-aws">i-hate-this<a>
  </li>
  <li>
    <a href="mailto:i-love-this@drawohara.io?subject=/