<html color-mode="user" lang="es">
  <head>
    <base href='/es' />

    <!-- ga -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DQVD9T27V4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DQVD9T27V4');
    </script>

    <!-- deps -->
    <script type="module" src="/assets/js/turbo.es2017-esm.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.fuchsia.min.css"
    >

    <!-- defaults -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark" />

    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <!-- meta -->
    <title>Mejores prácticas de Resque.</title>

    <meta property="og:title" content="Mejores prácticas de Resque."/>
    <meta property="og:description" content="sigue adelante." />
    <meta property="og:image" content="https://drawohara.io/media/mick.jpg" />

    <meta property="og:image:type" content="image/jpeg" />

    <meta property="site:route" content=""/dojo4/archive/:id"">
    <meta property="site:params" content="{"ext":null,"id":"resque-best-practices"}">
    <meta property="site:path_info" content=""/resque-best-practices"">

    <style>
      /* anti pico */
      a {text-decoration: none !important; }

      /* anti turbo */
      html { transition: none !important; }
      .turbo-progress-bar { visibility: hidden; }

      /* anti progressive */
      html { margin: 1em; }
      img { display: block; text-align: center; }
    </style>

    <script>
      document.addEventListener("turbo:load", function() {
        const progressBar = document.querySelector('.turbo-progress-bar');
        if (progressBar) {
          progressBar.remove();
        }
      });
    </script>
  </head>

  <body>
    <header>
      <a href="/home">@drawohara</a>
      <hr>
    </header>

    <main>
      <div class="ro markdown">

        <h2 id="introduction">Introducción</h2>

        <p>Resque ( https://github.com/defunkt/resque ) es una herramienta muy buena, robusta y de calidad de producción para trabajos en segundo plano en rails. Sin embargo, deja mucho pensamiento al desarrollador sobre las mejores prácticas para modelar tus trabajos, gestionar despliegues y gestionar procesos de trabajadores. A continuación, se presenta un conjunto de mejores prácticas para usar resque/redis como tu sistema de trabajos en segundo plano.</p>

        <h2 id="managing-the-background-processes">Gestión de los Procesos en Segundo Plano</h2>

        <p>Resque tiene algunas facilidades para gestionar procesos en segundo plano, pero son rudimentarias y tienen errores. Usamos este sencillo script de envoltura para gestionar una única instancia del daemon de trabajos en segundo plano:</p>

        <p><br /><br />
        <br /></p>

        <script src="https://gist.github.com/3123756.js?file=jobs.rb"></script>

        <p><br /><br />
        <br /></p>

        <h2 id="modeling-your-jobs">Modelado de tus Trabajos</h2>

        <p>Una de las primeras cosas que hacer es determinar cómo modelar tus trabajos. Resque hace que sea bastante simple enviar métodos arbitrarios en módulos, pero preferimos hacer algo un poco más limpio. En particular, nos gusta tener ids en los trabajos, poder consultarlos fácilmente y hacerlos ultra duraderos frente a fallos del sistema o del proceso. Simplemente consolidando toda la lógica de trabajo en un solo modelo que sombrea el trabajo de resque, esto es bastante posible. Aquí está nuestra clase de trabajo base.</p>

        <p><br /><br />
        <br /></p>

        <script src="https://gist.github.com/3123839.js?file=job.rb"></script>

        <p><br /><br />
        <br /></p>

        <p>Como probablemente puedes ver, esta clase (que podría ser fácilmente portada a ActiveRecord) permite la presentación de trabajos arbitrarios, correo electrónico u otros, y cada trabajo deja una huella en la base de datos principal que lo vincula a la entrada de resque/redis. Facilita mucho trabajar con objetos de trabajo: por ejemplo, tener un bucle de sondeo que verifique el estado de un trabajo en particular por id, o obtener un recuento rápido de cuántos trabajos han tenido éxito en la última semana. También mantiene nuestra instalación de resque súper vanilla: no usamos ningún plugin, y hace posible cambiar a otro sistema de procesamiento en segundo plano en cuestión de minutos. Acerca de la única gestión que necesita es una tarea periódica para limpiar la colección/tabla de trabajos. Usamos whenever ( https://github.com/javan/whenever/ ) más una tarea rake para lograr esto:</p>

        <p><br /><br />
        <br /></p>

        <script src="https://gist.github.com/3123860.js?file=jobs.rake"></script>

        <p><br /><br />
        <br /></p>

        <script src="https://gist.github.com/3123860.js?file=schedule.rb"></script>

        <p><br /><br />
        <br /></p>

        <h2 id="deployment">Despliegue</h2>

        <p>Finalmente, tu despliegue necesita mantener las cosas en marcha:</p>

        <p><br /><br />
        <br /></p>

        <script src="https://gist.github.com/3123860.js?file=Capfile.rb"></script>

        <p><br /></p>

      </div>
    </main>

    <footer>
      <hr>
      <a href="/goto" name="goto">&mdash;&gt; ir a</a>
      <blockquote>
        <ul>
          <li>
            <a href="/about">sobre<a>
          </li>
          <li>
            <a href="mailto:i-hate-this@drawohara.io?subject=/resque-best-practices">i-hate-this<a>
          </li>
          <li>
            <a href="mailto:i-love-this@drawohara.io?subject=/resque-best-practices">i-love-this<a>
          </li>
          <li>
            <a href="/contact">contacto<a>
          </li>
        </ul>
      </blockquote>
      <a href="/">&lt;&mdash; salir</a>
    </footer>
  </body>
</html>