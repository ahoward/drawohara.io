{
  "data": {
    "dojo4/configuring-the-default-virtual-host-in-apache2": {
      "published_at": "2012-12-13 00:00:00 UTC",
      "title": "Configuring the default VirtualHost in apache2",
      "author": "ara@dojo4.com",
      "body": "<div class=\"ro markdown\">\n  <div class=\"language-apache highlighter-rouge\"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>\n</div><div class='code-line code-line-2'>\n</div><div class='code-line code-line-3'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-4'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-5'><span style=\"color: #6e7781\"># apache has the odd behaviour of routing any request with a bad or unknown</span>\n</div><div class='code-line code-line-6'><span style=\"color: #6e7781\"># Host: header to the first virtual host found in it's config.  this can cause</span>\n</div><div class='code-line code-line-7'><span style=\"color: #6e7781\"># serioulsy bad issues when multiple sites are hosted in the same apache</span>\n</div><div class='code-line code-line-8'><span style=\"color: #6e7781\"># instance.  for example, a failed request for http://foo.bar.com/missing</span>\n</div><div class='code-line code-line-9'><span style=\"color: #6e7781\"># could hit a passenger virtual host and cause unspecfied behaviour depending</span>\n</div><div class='code-line code-line-10'><span style=\"color: #6e7781\"># on how that application behaves.</span>\n</div><div class='code-line code-line-11'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-12'><span style=\"color: #6e7781\"># the solution is to ensure a catch-all virtual host exists and is loaded</span>\n</div><div class='code-line code-line-13'><span style=\"color: #6e7781\"># before all other virtual host configuration files - and that this virutal</span>\n</div><div class='code-line code-line-14'><span style=\"color: #6e7781\"># host simply 404's (you could also serve a friendly error page)</span>\n</div><div class='code-line code-line-15'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-16'><span style=\"color: #6e7781\"># assuming a layout where apache conf files are loaded from, eg:</span>\n</div><div class='code-line code-line-17'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-18'><span style=\"color: #6e7781\">#   /etc/apache2/sites-enabled/*.conf</span>\n</div><div class='code-line code-line-19'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-20'><span style=\"color: #6e7781\"># you should put this configuation in a file named</span>\n</div><div class='code-line code-line-21'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-22'><span style=\"color: #6e7781\">#   /etc/apache2/sites-enabled/0.conf</span>\n</div><div class='code-line code-line-23'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-24'><span style=\"color: #6e7781\"># the '0.conf' ensures it's loaded first.  you can validate that this config</span>\n</div><div class='code-line code-line-25'><span style=\"color: #6e7781\"># is loaded first via</span>\n</div><div class='code-line code-line-26'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-27'><span style=\"color: #6e7781\">#   ls -1 /etc/apache2/sites-enabled/ | sort | head -1</span>\n</div><div class='code-line code-line-28'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-29'><span style=\"color: #6e7781\"># this should print</span>\n</div><div class='code-line code-line-30'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-31'><span style=\"color: #6e7781\">#   /etc/apache2/sites-enabled/0.conf</span>\n</div><div class='code-line code-line-32'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-33'><span style=\"color: #6e7781\"># once the configuration is in place you can test that it is indeed the</span>\n</div><div class='code-line code-line-34'><span style=\"color: #6e7781\"># default/first configuration used via</span>\n</div><div class='code-line code-line-35'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-36'><span style=\"color: #6e7781\">#   curl --silent --header 'Host: fu.bar.com' your.domain.com</span>\n</div><div class='code-line code-line-37'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-38'><span style=\"color: #6e7781\"># the default apache 404 page will be served is this is correct.  obviously</span>\n</div><div class='code-line code-line-39'><span style=\"color: #6e7781\"># you can configure the default virtual servers to have an acutal document</span>\n</div><div class='code-line code-line-40'><span style=\"color: #6e7781\"># root, etc...</span>\n</div><div class='code-line code-line-41'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-42'><span style=\"color: #6e7781\"># another important note.  it is *not* enough to simple configure the</span>\n</div><div class='code-line code-line-43'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-44'><span style=\"color: #6e7781\">#   _default_:80</span>\n</div><div class='code-line code-line-45'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-46'><span style=\"color: #6e7781\"># virtual host.</span>\n</div><div class='code-line code-line-47'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-48'><span style=\"color: #6e7781\"># you also need to setup the actual named host</span>\n</div><div class='code-line code-line-49'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-50'><span style=\"color: #6e7781\">#   ServerName _default_</span>\n</div><div class='code-line code-line-51'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-52'><span style=\"color: #6e7781\"># the reason for this is that name based virtual hosting will use, by default,</span>\n</div><div class='code-line code-line-53'><span style=\"color: #6e7781\"># the first *name based virtual host* so you cannot rely on an un-named one,</span>\n</div><div class='code-line code-line-54'><span style=\"color: #6e7781\"># which would suffice in most situations.</span>\n</div><div class='code-line code-line-55'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-56'>\n</div><div class='code-line code-line-57'>\n</div><div class='code-line code-line-58'><span style=\"color: #6e7781\"># this section will catch requests to missing hosts under a name-based vhost</span>\n</div><div class='code-line code-line-59'><span style=\"color: #6e7781\"># configuration</span>\n</div><div class='code-line code-line-60'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-61'>&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">&lt;</span><span style=\"color: #0550ae\">VirtualHost</span><span style=\"color: #116329\"> *:80</span><span style=\"color: #24292f;background-color: #f6f8fa\">&gt;</span>\n</div><div class='code-line code-line-62'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #953800\">ServerName</span>&nbsp;_default_\n</div><div class='code-line code-line-63'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #953800\">Redirect</span>&nbsp;404&nbsp;/\n</div><div class='code-line code-line-64'>&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">&lt;/</span><span style=\"color: #0550ae\">VirtualHost</span><span style=\"color: #24292f;background-color: #f6f8fa\">&gt;</span>\n</div><div class='code-line code-line-65'>\n</div><div class='code-line code-line-66'>\n</div><div class='code-line code-line-67'><span style=\"color: #6e7781\"># and this will handle the rest</span>\n</div><div class='code-line code-line-68'><span style=\"color: #6e7781\">#</span>\n</div><div class='code-line code-line-69'>&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">&lt;</span><span style=\"color: #0550ae\">VirtualHost</span><span style=\"color: #116329\"> _default_:80</span><span style=\"color: #24292f;background-color: #f6f8fa\">&gt;</span>\n</div><div class='code-line code-line-70'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #953800\">Redirect</span>&nbsp;404&nbsp;/\n</div><div class='code-line code-line-71'>&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">&lt;/</span><span style=\"color: #0550ae\">VirtualHost</span><span style=\"color: #24292f;background-color: #f6f8fa\">&gt;</span>\n</div><div class='code-line code-line-72'>\n</div><div class='code-line code-line-73'>\n</div><div class='code-line code-line-74'>\n</div></code></div>\n\n</div>\n",
      "assets": {},
      "_meta": {
        "identifier": "dojo4/configuring-the-default-virtual-host-in-apache2",
        "type": "dojo4",
        "id": "configuring-the-default-virtual-host-in-apache2",
        "urls": [
          "/ro/dojo4/configuring-the-default-virtual-host-in-apache2/body.md"
        ],
        "created_at": "2025-05-06 08:47:13 +0000",
        "updated_at": "2025-05-06 08:47:13 +0000",
        "rel": {
          "curr": "dojo4/configuring-the-default-virtual-host-in-apache2",
          "prev": "dojo4/fabrication-illustrated-infographics-and-eli-who-elihuu",
          "next": "dojo4/dojo4-hosts-the-denver-ad-club-kegs-with-legs-party-on-nov-29-2012"
        }
      }
    }
  },
  "_meta": {
    "url": "/ro",
    "type": "dojo4",
    "id": "configuring-the-default-virtual-host-in-apache2"
  }
}