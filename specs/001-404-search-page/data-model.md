# Data Model: 404 Search Page

**Feature**: Static 404 Page with Search
**Date**: 2025-11-13

## Overview

The search system uses two static JSON files generated at build time. No database or server-side storage required.

## Entities

### PageDocument

Represents a searchable page on the site.

**Fields**:
- `title` (string, required): Page title extracted from `<title>` or `<h1>`
- `href` (string, required): Relative URL path (e.g., `/about/`, `/blog/post/`)
- `content` (string, optional): First 150 characters of page content or meta description

**Validation Rules**:
- `href` must start with `/` and be a valid relative URL
- `title` must be non-empty
- `content` truncated to 150 characters max
- All HTML tags stripped from `title` and `content`

**Example**:
```json
{
  "title": "About Us - Our Mission and Team",
  "href": "/about/",
  "content": "We are a team of developers building amazing things. Our mission is to create simple, powerful tools that help people work better."
}
```

### SearchIndex

Lunr.js pre-built search index.

**Fields** (generated by lunr.js):
- `version` (string): Lunr version used to build index
- `fields` (array): Searchable fields (`["title", "content"]`)
- `fieldVectors` (object): Inverted index for fast searching
- `invertedIndex` (object): Term frequency data
- `pipeline` (array): Text processing pipeline configuration

**Format**: JSON serialization of lunr.Index

**Size**: Target <100KB compressed (gzip/brotli)

## Data Flow

### Build Time

```
HTML Pages (build/**/*.html)
    ↓
Extract (bin/generate-search-index)
    ↓
pages.json (PageDocument array)
    ↓
Build Index (Node.js + lunr.js)
    ↓
search-index.json (SearchIndex)
```

### Runtime (Client-Side)

```
User lands on 404.html
    ↓
Static URL list renders immediately
    ↓
(Async) Load search-index.json + pages.json
    ↓
Initialize lunr.Index
    ↓
User types in search box
    ↓
Query search index (<10ms)
    ↓
Map results to PageDocument data
    ↓
Render filtered results
```

## Storage

### build/pages.json

**Purpose**: Source data for search results display

**Format**: JSON array of PageDocument objects

**Size**: ~400-500 KB raw, ~70-100 KB gzipped

**Example**:
```json
[
  {
    "title": "Home",
    "href": "/",
    "content": "Welcome to our site. Find everything you need here."
  },
  {
    "title": "Blog - Latest Posts",
    "href": "/blog/",
    "content": "Read our latest articles on development, design, and more."
  }
]
```

### build/search-index.json

**Purpose**: Pre-built lunr.js search index

**Format**: JSON serialization of lunr.Index

**Size**: ~60-80 KB gzipped

**Generated by**: `lunr.Index#toJSON()` in Node.js build script

## Extraction Logic

### Title Priority

1. `<title>` tag content
2. First `<h1>` if title tag empty
3. Filename if both empty

### Content Priority

1. `<meta name="description">` content
2. `<meta property="og:description">` content
3. First `<p>` in `<article>`, `<main>`, or `.content`
4. Empty string if nothing found

### URL Normalization

- Convert file path to web path: `build/about/index.html` → `/about/`
- Remove `/index.html` suffix
- Ensure leading `/`
- Remove `build/` prefix

## Index Configuration

### Lunr.js Settings

```javascript
lunr(function () {
  this.ref('href');                    // Unique identifier
  this.field('title', { boost: 10 });  // Boost title matches 10x
  this.field('content');                // Normal weight

  // Default pipeline (stemmer, stopWordFilter)
  // No customization needed for standard use
})
```

### Search Query Syntax

- **Simple**: `about` (searches all fields)
- **Phrase**: `"user guide"` (exact phrase)
- **Field-specific**: `title:blog` (search only titles)
- **Wildcard**: `dev*` (matches development, developer, etc.)
- **Boost**: `important^2` (boost term importance)

Users will primarily use simple queries. Advanced syntax available but not documented to users.

## Progressive Enhancement

### Without JavaScript

- Static HTML `<ul>` list embedded in 404.html
- Generated at build time from pages.json
- Fully functional browsing experience

### With JavaScript

- Search index loads asynchronously
- Search box filters the list dynamically
- Results update as-you-type
- Matching text highlighted

## Constraints

- Maximum 1000 pages (practical limit for client-side search)
- Index must be <100KB compressed
- Search must complete in <100ms
- Page must work without JavaScript
- No server-side processing allowed (GitHub Pages limitation)

## Future Considerations

If the site grows beyond 500 pages:
- Implement field vector compaction (reduces size by 25%)
- Consider title-only search for less important pages
- Split into multiple indexes (e.g., blog vs docs)
- Add categories/tags for filtered search

Not implementing now due to YAGNI principle.
