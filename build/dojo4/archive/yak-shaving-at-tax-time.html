<html color-mode="user" lang="en">
  <head>
  <!-- ga -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DQVD9T27V4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DQVD9T27V4');
</script>

  <!-- deps -->
    <script type="module" src="/assets/js/turbo.es2017-esm.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.fuchsia.min.css"
    >

  <!-- langs -->
  <!--
    https://developers.google.com/search/docs/specialty/international/localized-versions#html
  -->
   <link rel="alternate" hreflang="en" href="/" />
   <link rel="alternate" hreflang="uk" href="https://drawohara.io/langs/uk" />
   <link rel="alternate" hreflang="sv" href="https://drawohara.io/langs/sv" />
   <link rel="alternate" hreflang="fr" href="https://drawohara.io/langs/fr" />
   <link rel="alternate" hreflang="es" href="https://drawohara.io/langs/es" />
   <link rel="alternate" hreflang="it" href="https://drawohara.io/langs/it" />

  <!-- defaults -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark" />

  <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

  <!-- meta -->
    <title>@drawohara</title>

<meta property="og:title" content="@drawohara"/>
<meta property="og:description" content="my insides are made out of outside. i bite." />
<meta property="og:image" content="https://drawohara.io/media/mick.jpg" />




  <meta property="og:image:type" content="image/jpeg" />

    <meta property="site:route" content=""/dojo4/archive/:id"">
    <meta property="site:params" content="{"ext":null,"id":"yak-shaving-at-tax-time"}">
    <meta property="site:path_info" content=""/yak-shaving-at-tax-time"">

    <style>
      /* anti pico */
      a {text-decoration: none !important; }

      /* anti turbo */
      html { transition: none !important; }
      .turbo-progress-bar { visibility: hidden; }

      /* anti progressive */
      html { margin: 1em; }
      img { display: block; text-align: center; }
    </style>

    <script>
      document.addEventListener("turbo:load", function() {
        const progressBar = document.querySelector('.turbo-progress-bar');
        if (progressBar) {
          progressBar.remove();
        }
      });
    </script>
  </head>

  <body>
    <header>
      <a href="/home">@drawohara</a>
<hr>
    </header>

    <main>
      <div class="ro markdown">
  <p>i wrote this script while doing my taxes because, like all good programmers, i’d rather write a tool than use a bloody spreadsheet program</p>

<p>it saves me from</p>

<ul>
  <li>having to use a spreadsheet to categorize my taxes</li>
</ul>

<p>and, additionally it saves me from having to use a spreadsheet to categorize my taxes</p>

<p>with out further ado (that’s for you @steve)</p>

<p><br /><br />
<br /></p>

<div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'><span style="color: #6e7781">#! /usr/bin/env ruby</span>
</div><div class='code-line code-line-2'>
</div><div class='code-line code-line-3'><span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'csv'</span>
</div><div class='code-line code-line-4'><span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'pp'</span>
</div><div class='code-line code-line-5'><span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'readline'</span>
</div><div class='code-line code-line-6'><span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'fileutils'</span>
</div><div class='code-line code-line-7'>
</div><div class='code-line code-line-8'><span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'rubygems'</span>
</div><div class='code-line code-line-9'>
</div><div class='code-line code-line-10'><span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'main'</span>
</div><div class='code-line code-line-11'><span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'coerce'</span>
</div><div class='code-line code-line-12'><span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'arrayfields'</span>
</div><div class='code-line code-line-13'>
</div><div class='code-line code-line-14'><span style="color: #953800">Main</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-15'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">synopsis</span>&nbsp;<span style="color: #0550ae">&lt;&lt;-</span><span style="color: #953800">__</span>
</div><div class='code-line code-line-16'>
</div><div class='code-line code-line-17'><span style="color: #0a3069">    ruby categorize.rb transactions.csv</span>
</div><div class='code-line code-line-18'>
</div><div class='code-line code-line-19'><span style="color: #0a3069">    ruby categorize.rb transactions.csv --continue # where i left off...</span>
</div><div class='code-line code-line-20'>
</div><div class='code-line code-line-21'><span style="color: #953800">  __</span>
</div><div class='code-line code-line-22'>
</div><div class='code-line code-line-23'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">description</span>&nbsp;<span style="color: #0550ae">&lt;&lt;-</span><span style="color: #953800">__</span>
</div><div class='code-line code-line-24'>
</div><div class='code-line code-line-25'><span style="color: #0a3069">    categorize is a damn transaction categorizing damn script i wrote doing my damn taxes</span>
</div><div class='code-line code-line-26'>
</div><div class='code-line code-line-27'><span style="color: #0a3069">    it works on a csv that looks like</span>
</div><div class='code-line code-line-28'>
</div><div class='code-line code-line-29'><span style="color: #0a3069">      Transaction Number,Date,Description,Memo,Amount Debit,Amount Credit ,Balance,Check Number,Fees  </span>
</div><div class='code-line code-line-30'><span style="color: #0a3069">      "20121231000000[-7:MST]*-9.99*42**Withdrawal",12/31/2012,"Withdrawal","Amazon Video On Demand 866-216-1072 WA Date 12/29/12 000031828826 5735",-9.99, ,"492.93",,</span>
</div><div class='code-line code-line-31'><span style="color: #0a3069">      "20121231000000[-7:MST]*-4000.00*12**Withdrawal Home Banking",12/31/2012,"Withdrawal Home Banking","Transfer To HOWARD,ARA T 0000133543 Share 0008 Online Banking Transfer Dec. 31, 2012 09:37 Ref: 325989",-4000.00, ,"502.92",,</span>
</div><div class='code-line code-line-32'><span style="color: #0a3069">      "20121231000000[-7:MST]*4393.89*501**Deposit DOJO4 LLC",12/31/2012,"Deposit DOJO4 LLC","TYPE: QUICKBOOKS ID: 1722616653 CO: DOJO4 LLC",,4393.89 ,"4502.92",,</span>
</div><div class='code-line code-line-33'><span style="color: #0a3069">      "20121227000000[-7:MST]*-17.99*42**Withdrawal",12/27/2012,"Withdrawal","WWW.RDIOCHARGE.COM 877-7346843 CA Date 12/26/12 900017146258 8699",-17.99, ,"122.02",,</span>
</div><div class='code-line code-line-34'><span style="color: #0a3069">      ...</span>
</div><div class='code-line code-line-35'>
</div><div class='code-line code-line-36'><span style="color: #0a3069">    a lot of banks can export these</span>
</div><div class='code-line code-line-37'>
</div><div class='code-line code-line-38'><span style="color: #0a3069">    after using it the file will look something like this</span>
</div><div class='code-line code-line-39'>
</div><div class='code-line code-line-40'><span style="color: #0a3069">      TRANSACTION_NUMBER,DATE,DESCRIPTION,MEMO,AMOUNT_DEBIT,AMOUNT_CREDIT,BALANCE,CHECK_NUMBER,FEES,CATEGORY</span>
</div><div class='code-line code-line-41'><span style="color: #0a3069">      20121015000000[-7:MST]*-3.00*21**Transfer fee,10/15/2012,Transfer fee,"",-3.00,"",9.99,,,fee</span>
</div><div class='code-line code-line-42'><span style="color: #0a3069">      ...</span>
</div><div class='code-line code-line-43'>
</div><div class='code-line code-line-44'><span style="color: #0a3069">    which is to say it'll have a CATEGORY column and all rows categorized</span>
</div><div class='code-line code-line-45'>
</div><div class='code-line code-line-46'><span style="color: #0a3069">    it really doesn't care about the data too much, needing just one field to</span>
</div><div class='code-line code-line-47'><span style="color: #0a3069">    sort by.  by default this is the 'Memo' field but the script doesn't</span>
</div><div class='code-line code-line-48'><span style="color: #0a3069">    really care if it's missing.  besides, you can specifi the sort field with</span>
</div><div class='code-line code-line-49'><span style="color: #0a3069">    '--sort' and you'll probably want to because the default mode rememers</span>
</div><div class='code-line code-line-50'><span style="color: #0a3069">    your last selection and provides it as a default as you're editing</span>
</div><div class='code-line code-line-51'><span style="color: #0a3069">    categories.</span>
</div><div class='code-line code-line-52'>
</div><div class='code-line code-line-53'><span style="color: #0a3069">    note that the script clobbers in the input file destructively, so make a</span>
</div><div class='code-line code-line-54'><span style="color: #0a3069">    backup if you really care.  well, it does, but still, know that it</span>
</div><div class='code-line code-line-55'><span style="color: #0a3069">    clobbers to allow continuing an editing session.</span>
</div><div class='code-line code-line-56'>
</div><div class='code-line code-line-57'><span style="color: #953800">  __</span>
</div><div class='code-line code-line-58'>
</div><div class='code-line code-line-59'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">argument</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">:transactions</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-60'>
</div><div class='code-line code-line-61'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">option</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">:continue</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">:c</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-62'>
</div><div class='code-line code-line-63'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">option</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">:sort</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">:s</span><span style="color: #24292f;background-color: #f6f8fa">){</span>
</div><div class='code-line code-line-64'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">default</span>&nbsp;<span style="color: #0a3069">'MEMO'</span>
</div><div class='code-line code-line-65'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-66'>
</div><div class='code-line code-line-67'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">option</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">:categories</span><span style="color: #24292f;background-color: #f6f8fa">){</span>
</div><div class='code-line code-line-68'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">default</span>&nbsp;<span style="color: #0550ae">&lt;&lt;-</span><span style="color: #953800">__</span>
</div><div class='code-line code-line-69'>
</div><div class='code-line code-line-70'><span style="color: #0a3069">      expense/client</span>
</div><div class='code-line code-line-71'><span style="color: #0a3069">      expense/client/meals</span>
</div><div class='code-line code-line-72'><span style="color: #0a3069">      expense/client/entertainment</span>
</div><div class='code-line code-line-73'>
</div><div class='code-line code-line-74'><span style="color: #0a3069">      expense/office</span>
</div><div class='code-line code-line-75'><span style="color: #0a3069">      expense/office/internet</span>
</div><div class='code-line code-line-76'><span style="color: #0a3069">      expense/office/phone</span>
</div><div class='code-line code-line-77'><span style="color: #0a3069">      expense/office/supplies</span>
</div><div class='code-line code-line-78'><span style="color: #0a3069">      expense/office/maintenance</span>
</div><div class='code-line code-line-79'>
</div><div class='code-line code-line-80'><span style="color: #0a3069">      expense/software</span>
</div><div class='code-line code-line-81'><span style="color: #0a3069">      expense/software/service</span>
</div><div class='code-line code-line-82'><span style="color: #0a3069">      expense/software/license</span>
</div><div class='code-line code-line-83'>
</div><div class='code-line code-line-84'><span style="color: #0a3069">      expense/hardware</span>
</div><div class='code-line code-line-85'>
</div><div class='code-line code-line-86'><span style="color: #0a3069">      income</span>
</div><div class='code-line code-line-87'><span style="color: #0a3069">      payroll</span>
</div><div class='code-line code-line-88'><span style="color: #0a3069">      transfer</span>
</div><div class='code-line code-line-89'><span style="color: #0a3069">      loan</span>
</div><div class='code-line code-line-90'><span style="color: #0a3069">      fee</span>
</div><div class='code-line code-line-91'>
</div><div class='code-line code-line-92'><span style="color: #0a3069">      beer</span>
</div><div class='code-line code-line-93'>
</div><div class='code-line code-line-94'><span style="color: #0a3069">      uncategorized</span>
</div><div class='code-line code-line-95'><span style="color: #953800">    __</span>
</div><div class='code-line code-line-96'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-97'>
</div><div class='code-line code-line-98'>&nbsp;&nbsp;<span style="color: #cf222e">def</span>&nbsp;<span style="color: #8250df">run</span>
</div><div class='code-line code-line-99'>&nbsp;&nbsp;<span style="color: #6e7781"># setup</span>
</div><div class='code-line code-line-100'>&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-101'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@categories</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">Coerce</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">list_of_strings</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">params</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0a3069">:categories</span><span style="color: #24292f;background-color: #f6f8fa">].</span><span style="color: #8250df">values</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-102'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@transactions</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">params</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0a3069">:transactions</span><span style="color: #24292f;background-color: #f6f8fa">].</span><span style="color: #8250df">value</span>
</div><div class='code-line code-line-103'>
</div><div class='code-line code-line-104'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@fields</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">[]</span>&nbsp;
</div><div class='code-line code-line-105'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@rows</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">[]</span>
</div><div class='code-line code-line-106'>
</div><div class='code-line code-line-107'>&nbsp;&nbsp;<span style="color: #6e7781"># parse the data and massage it a little</span>
</div><div class='code-line code-line-108'>&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-109'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">CSV</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">parse</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #953800">IO</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">read</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">@transactions</span><span style="color: #24292f;background-color: #f6f8fa">))</span>&nbsp;<span style="color: #cf222e">do</span>&nbsp;<span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #0550ae">|</span>
</div><div class='code-line code-line-110'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">map</span><span style="color: #24292f;background-color: #f6f8fa">{</span><span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #0550ae">|</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">cell</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">?</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">strip</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">:</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-111'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">next</span>&nbsp;<span style="color: #cf222e">unless</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">detect</span><span style="color: #24292f;background-color: #f6f8fa">{</span><span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">value</span><span style="color: #0550ae">|</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">value</span><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-112'>
</div><div class='code-line code-line-113'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #0550ae">@fields</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">empty?</span>
</div><div class='code-line code-line-114'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@fields</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">map</span><span style="color: #24292f;background-color: #f6f8fa">{</span><span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #0550ae">|</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">strip</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">upcase</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">gsub</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #116329">/\s+/</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">'_'</span><span style="color: #24292f;background-color: #f6f8fa">)}</span>
</div><div class='code-line code-line-115'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@fields</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">push</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">'CATEGORY'</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #cf222e">unless</span>&nbsp;<span style="color: #0550ae">@fields</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">include?</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">'CATEGORY'</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-116'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">else</span>
</div><div class='code-line code-line-117'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">map</span><span style="color: #24292f;background-color: #f6f8fa">{</span><span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #0550ae">|</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">cell</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">?</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">strip</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">:</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-118'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">fields</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #0550ae">@fields</span>
</div><div class='code-line code-line-119'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@rows</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">push</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-120'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-121'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-122'>
</div><div class='code-line code-line-123'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">sort_key</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">params</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0a3069">:sort</span><span style="color: #24292f;background-color: #f6f8fa">].</span><span style="color: #8250df">value</span>
</div><div class='code-line code-line-124'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@rows</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">sort!</span><span style="color: #24292f;background-color: #f6f8fa">{</span><span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">a</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">b</span><span style="color: #0550ae">|</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">a</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">sort_key</span><span style="color: #24292f;background-color: #f6f8fa">]</span>&nbsp;<span style="color: #0550ae">&lt;=&gt;</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">b</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">sort_key</span><span style="color: #24292f;background-color: #f6f8fa">]}</span>
</div><div class='code-line code-line-125'>
</div><div class='code-line code-line-126'>&nbsp;&nbsp;<span style="color: #6e7781"># auto-save on exit magic-ness-ish</span>
</div><div class='code-line code-line-127'>&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-128'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">save</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">proc</span>&nbsp;<span style="color: #cf222e">do</span>
</div><div class='code-line code-line-129'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">begin</span>
</div><div class='code-line code-line-130'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">buf</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">CSV</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">generate</span><span style="color: #24292f;background-color: #f6f8fa">{</span><span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">csv</span><span style="color: #0550ae">|</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">csv</span>&nbsp;<span style="color: #0550ae">&lt;&lt;</span>&nbsp;<span style="color: #0550ae">@fields</span><span style="color: #24292f;background-color: #f6f8fa">;</span>&nbsp;<span style="color: #0550ae">@rows</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">each</span><span style="color: #24292f;background-color: #f6f8fa">{</span><span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #0550ae">|</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">csv</span>&nbsp;<span style="color: #0550ae">&lt;&lt;</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">}}</span>
</div><div class='code-line code-line-131'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">open</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #0550ae">@transactions</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069">.tmp"</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">"wb+"</span><span style="color: #24292f;background-color: #f6f8fa">){</span><span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">fd</span><span style="color: #0550ae">|</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">fd</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">write</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">buf</span><span style="color: #24292f;background-color: #f6f8fa">)}</span>
</div><div class='code-line code-line-132'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">FileUtils</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">mv</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">@transactions</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">"</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #0550ae">@transactions</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069">.bak"</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-133'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">FileUtils</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">mv</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #0550ae">@transactions</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069">.tmp"</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0550ae">@transactions</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-134'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">rescue</span>&nbsp;<span style="color: #953800">Object</span>&nbsp;<span style="color: #0550ae">=&gt;</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">e</span>
</div><div class='code-line code-line-135'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">STDERR</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">puts</span>&nbsp;<span style="color: #0a3069">"</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">e</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">message</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069">(</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">e</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">class</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069">)</span><span style="color: #0a3069">\n</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #953800">Array</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">e</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">backtrace</span><span style="color: #24292f;background-color: #f6f8fa">).</span><span style="color: #8250df">join</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">10</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">chr</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069">"</span>
</div><div class='code-line code-line-136'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-137'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-138'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">at_exit</span><span style="color: #24292f;background-color: #f6f8fa">{</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">save</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">call</span><span style="color: #24292f;background-color: #f6f8fa">()</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-139'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">trap</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">'SIGINT'</span><span style="color: #24292f;background-color: #f6f8fa">){</span>&nbsp;<span style="color: #953800">puts</span><span style="color: #24292f;background-color: #f6f8fa">;</span>&nbsp;<span style="color: #953800">exit</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">0</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-140'>
</div><div class='code-line code-line-141'>&nbsp;&nbsp;<span style="color: #6e7781"># setup teh readlinez to auto-complete our categories</span>
</div><div class='code-line code-line-142'>&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-143'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">Readline</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">completion_append_character</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #0a3069">' '</span>
</div><div class='code-line code-line-144'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">Readline</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">completion_proc</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">proc</span>&nbsp;<span style="color: #cf222e">do</span>&nbsp;<span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">string</span><span style="color: #0550ae">|</span>
</div><div class='code-line code-line-145'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">re</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #116329">/</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #953800">Regexp</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">escape</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">string</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #116329">/</span>
</div><div class='code-line code-line-146'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">candidates</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #0550ae">@categories</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">grep</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">re</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-147'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-148'>
</div><div class='code-line code-line-149'>&nbsp;&nbsp;<span style="color: #6e7781"># during edit we'll track the last entered category and keep it as a sane</span>
</div><div class='code-line code-line-150'>&nbsp;&nbsp;<span style="color: #6e7781"># default when &lt;enter&gt; is pressed.  when combined with sorting this makes</span>
</div><div class='code-line code-line-151'>&nbsp;&nbsp;<span style="color: #6e7781"># editing big blocks if similar entires real quick.</span>
</div><div class='code-line code-line-152'>&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-153'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">current_category</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #cf222e">nil</span>
</div><div class='code-line code-line-154'>
</div><div class='code-line code-line-155'>&nbsp;&nbsp;<span style="color: #6e7781"># ok edit dat shit</span>
</div><div class='code-line code-line-156'>&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-157'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@rows</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">each</span>&nbsp;<span style="color: #cf222e">do</span>&nbsp;<span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #0550ae">|</span>
</div><div class='code-line code-line-158'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># skip to the first un-categorized row iff --continue given...</span>
</div><div class='code-line code-line-159'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-160'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">params</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0a3069">:continue</span><span style="color: #24292f;background-color: #f6f8fa">].</span><span style="color: #8250df">given?</span>
</div><div class='code-line code-line-161'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">next</span>&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #0550ae">!</span><span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0a3069">:CATEGORY</span><span style="color: #24292f;background-color: #f6f8fa">].</span><span style="color: #8250df">to_s</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">strip</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">empty?</span>
</div><div class='code-line code-line-162'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-163'>
</div><div class='code-line code-line-164'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># grok the with of the header/row so we can print them out at the same</span>
</div><div class='code-line code-line-165'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># width and avoid breaking our eyes.  this is pretty much a hacky way to</span>
</div><div class='code-line code-line-166'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># do this</span>
</div><div class='code-line code-line-167'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-168'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">header</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #0550ae">@fields</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">map</span><span style="color: #24292f;background-color: #f6f8fa">{</span><span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">field</span><span style="color: #0550ae">|</span>&nbsp;<span style="color: #0a3069">"</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">field</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069">"</span><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-169'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">each_with_index</span>&nbsp;<span style="color: #cf222e">do</span>&nbsp;<span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">index</span><span style="color: #0550ae">|</span>
</div><div class='code-line code-line-170'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">header</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">index</span><span style="color: #24292f;background-color: #f6f8fa">]</span>&nbsp;<span style="color: #0550ae">&lt;&lt;</span>&nbsp;<span style="color: #0a3069">' '</span>&nbsp;<span style="color: #cf222e">until</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">header</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">index</span><span style="color: #24292f;background-color: #f6f8fa">].</span><span style="color: #8250df">to_s</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">size</span>&nbsp;<span style="color: #0550ae">&gt;=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">cell</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">to_s</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">size</span>
</div><div class='code-line code-line-171'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-172'>
</div><div class='code-line code-line-173'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">copy</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">proc</span>&nbsp;<span style="color: #cf222e">do</span>&nbsp;<span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">object</span><span style="color: #0550ae">|</span>
</div><div class='code-line code-line-174'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">Marshal</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">load</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #953800">Marshal</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">dump</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">object</span><span style="color: #24292f;background-color: #f6f8fa">))</span>
</div><div class='code-line code-line-175'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-176'>
</div><div class='code-line code-line-177'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">formatted</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">proc</span>&nbsp;<span style="color: #cf222e">do</span>&nbsp;<span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">array</span><span style="color: #0550ae">|</span>
</div><div class='code-line code-line-178'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">array</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">copy</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">array</span><span style="color: #24292f;background-color: #f6f8fa">]</span>
</div><div class='code-line code-line-179'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">array</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">fields</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #0550ae">@fields</span>
</div><div class='code-line code-line-180'>
</div><div class='code-line code-line-181'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">header</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">each_with_index</span>&nbsp;<span style="color: #cf222e">do</span>&nbsp;<span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">field</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">index</span><span style="color: #0550ae">|</span>
</div><div class='code-line code-line-182'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">array</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">index</span><span style="color: #24292f;background-color: #f6f8fa">]</span>&nbsp;<span style="color: #0550ae">||=</span>&nbsp;<span style="color: #0a3069">''</span>
</div><div class='code-line code-line-183'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">array</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">index</span><span style="color: #24292f;background-color: #f6f8fa">]</span>&nbsp;<span style="color: #0550ae">&lt;&lt;</span>&nbsp;<span style="color: #0a3069">' '</span>&nbsp;<span style="color: #cf222e">until</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">array</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">index</span><span style="color: #24292f;background-color: #f6f8fa">].</span><span style="color: #8250df">to_s</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">size</span>&nbsp;<span style="color: #0550ae">&gt;=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">header</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">index</span><span style="color: #24292f;background-color: #f6f8fa">].</span><span style="color: #8250df">size</span>
</div><div class='code-line code-line-184'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-185'>
</div><div class='code-line code-line-186'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">array</span>
</div><div class='code-line code-line-187'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-188'>
</div><div class='code-line code-line-189'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># build the prompt</span>
</div><div class='code-line code-line-190'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-191'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">prompt</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">formatted</span><span style="color: #24292f;background-color: #f6f8fa">[</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">]</span>&nbsp;
</div><div class='code-line code-line-192'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">current_category</span>
</div><div class='code-line code-line-193'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">prompt</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">push</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"&lt;- [</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">current_category</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069">]"</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-194'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-195'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">prompt</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">prompt</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">join</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">' | '</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-196'>
</div><div class='code-line code-line-197'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># extract the category for this row</span>
</div><div class='code-line code-line-198'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-199'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">category</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #cf222e">nil</span>
</div><div class='code-line code-line-200'>
</div><div class='code-line code-line-201'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">loop</span>&nbsp;<span style="color: #cf222e">do</span>
</div><div class='code-line code-line-202'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># this reads badly... but provides help/context and help while #</span>
</div><div class='code-line code-line-203'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># editing...</span>
</div><div class='code-line code-line-204'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-205'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">puts</span>&nbsp;<span style="color: #0a3069">'---'</span>
</div><div class='code-line code-line-206'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">puts</span>&nbsp;<span style="color: #0550ae">@categories</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">join</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"</span><span style="color: #0a3069">\n</span><span style="color: #0a3069">"</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-207'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">puts</span>
</div><div class='code-line code-line-208'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">puts</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">header</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">join</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">' | '</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-209'>
</div><div class='code-line code-line-210'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">line</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">Readline</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">readline</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">prompt</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069"> &gt;&gt; "</span><span style="color: #24292f;background-color: #f6f8fa">).</span><span style="color: #8250df">to_s</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">strip</span>
</div><div class='code-line code-line-211'>
</div><div class='code-line code-line-212'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">case</span>
</div><div class='code-line code-line-213'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">when</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">line</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">empty?</span>
</div><div class='code-line code-line-214'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">category</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0a3069">'CATEGORY'</span><span style="color: #24292f;background-color: #f6f8fa">]</span>&nbsp;<span style="color: #0550ae">||</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">current_category</span>
</div><div class='code-line code-line-215'>
</div><div class='code-line code-line-216'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">else</span>
</div><div class='code-line code-line-217'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">category</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">line</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">strip</span>
</div><div class='code-line code-line-218'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">current_category</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">category</span>
</div><div class='code-line code-line-219'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-220'>
</div><div class='code-line code-line-221'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">break</span>&nbsp;<span style="color: #cf222e">unless</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">category</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">to_s</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">strip</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">empty?</span>
</div><div class='code-line code-line-222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-223'>
</div><div class='code-line code-line-224'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># mark it and recall on top of our default set for subsequent readline</span>
</div><div class='code-line code-line-225'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># completions</span>
</div><div class='code-line code-line-226'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">#</span>
</div><div class='code-line code-line-227'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0a3069">'CATEGORY'</span><span style="color: #24292f;background-color: #f6f8fa">]</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">category</span>
</div><div class='code-line code-line-228'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">puts</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">formatted</span><span style="color: #24292f;background-color: #f6f8fa">[</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">row</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">].</span><span style="color: #8250df">join</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">' | '</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-229'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@categories</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">push</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">category</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #cf222e">unless</span>&nbsp;<span style="color: #0550ae">@categories</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">include?</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">category</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-230'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-231'>&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-232'><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-233'>
</div></code></div>

<p>ref: https://gist.github.com/anonymous/5079932</p>


</div>
    </main>

    <footer>
      <hr>
<a href="/goto" name="goto">&mdash;&gt; goto</a>
<blockquote>
<ul>
  <li>
    <a href="/now">/now<a>
  </li>
  <li>
    <a href="/about">/narcissism<a>
  </li>
  <li>
    <a href="/contact">/contact<a>
  </li>
  <li>
    <a href="mailto:i-love-this@drawohara.io?subject=/yak-shaving-at-tax-time">[[ ❤️  📧 ]]<a>
    is waaaay <strong>&gt;&gt;</strong> than
    <a href="mailto:i-hate-this@drawohara.io?subject=/yak-shaving-at-tax-time">[[ 🖤 📧 ]]<a>
  </li>
</ul>
</blockquote>
<a href="/">&lt;&mdash; eject</a>
    </footer>
  </body>
</html>