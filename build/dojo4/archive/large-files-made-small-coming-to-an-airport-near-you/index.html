<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>drawohara</title>

  

  <!-- favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

  <style>
    /* reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* layout */
    body {
      max-width: 42rem;
      margin: 2rem auto;
      padding: 0 1rem;
      font: 16px/1.6 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
      color: #333;
      background: #fff;
    }

    /* typography */
    h1, h2, h3, h4, h5, h6 {
      margin: 1.5rem 0 0.5rem;
      line-height: 1.2;
    }

    h1 { font-size: 2rem; }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.25rem; }

    p, blockquote, ul, ol {
      margin: 0.5rem 0;
    }

    li {
      margin-left: 2rem;
    }

    blockquote {
      margin-left: 1rem;
      padding-left: 1rem;
      border-left: 2px solid #ddd;
      font-style: italic;
    }

    /* links */
    a {
      color: #0066cc;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    a:visited {
      color: #551a8b;
    }

    /* code */
    code, pre {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
      background: #f5f5f5;
    }

    code {
      padding: 0.1em 0.3em;
      font-size: 0.9em;
    }

    pre {
      padding: 1rem;
      overflow-x: auto;
      margin: 1rem 0;
    }

    pre code {
      padding: 0;
      background: none;
    }

    /* images */
    img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1rem 0;
    }

    /* horizontal rule */
    hr {
      border: none;
      border-top: 1px solid #ddd;
      margin: 1rem 0;
    }

    /* header/footer */
    header {
      margin-bottom: 2rem;
    }

    footer {
      margin-top: 3rem;
      font-size: 0.9em;
      color: #666;
    }

    /* dark mode */
    @media (prefers-color-scheme: dark) {
      body {
        color: #ddd;
        background: #111;
      }

      a {
        color: #58a6ff;
      }

      a:visited {
        color: #a371f7;
      }

      code, pre {
        background: #222;
      }

      blockquote {
        border-left-color: #444;
      }

      hr {
        border-top-color: #333;
      }

      footer {
        color: #888;
      }
    }
  </style>
</head>

<body>
  <header>
    <a href="/">@drawohara</a>
<small>
  <a href="mailto:i-love-this@drawohara.io?subject=/large-files-made-small-coming-to-an-airport-near-you">‚ù§Ô∏è</a>
  ||
  <a href="mailto:this-makes-me-sad@drawohara.io?subject=/large-files-made-small-coming-to-an-airport-near-you">üíô</a>
</small>
<hr>
  </header>

  <main>
    <em>published on: 2013-05-31</em>
<br>
<br>
<div class="ro markdown">
  <p><img src="assets/airplane1980bq30x40in195.jpg" alt="img" /></p>

<p>For the past few months, dojo4 has been working feverishly on an very cool new product for our client: <a href="http://www.movime.com">MoviMe Networks</a> allowing air travelers to quickly rent and download feature films to their iPads from airport gates while waiting to board their flights.  We are excited to announce that the product has gone into live beta testing at Chicago O‚ÄôHare International Airport!</p>

<p>We hope you will fire up your iPad and give it a try the next time you are flying out of or through ORD.  While you are waiting for your movie to download you may like to contemplate all of disparate  components working together to facilitate your movie browsing and fast downloading.  First, a studio ingest automation system retrieves gigantic raw movie files from movie studios and re-encodes them for the perfect iPad viewing experience.  Then a centralized management system creates products in the MoviMe Store for those new movies which you can browse and purchase.  And, movie files are distributed to an in-airport Content Distribution Network (CDN) so they can be downloaded lickedy-split before you need to board your flight.  That‚Äôs a lot to consider in the brief time it took to download your movie.  Perhaps you should rent another while we cover some more of the interesting technical details‚Ä¶</p>

<p>Video files are large. A feature length HD version of a movie takes around 10GB. The files that people download from iTunes are in a 1-2GB range. The video files that we ended up using for MoviMe are around 1GB in size.</p>

<p>The size of these files introduced a few interesting challenges. Most HTTP libraries are not designed to work with such large files. They do not fit in the memory of an iPad. They take a long time to move. We needed to think differently about handling such files than we normally do about images and other media. Our solution was to upload and download files in fragments. We coded the iPad player to use byte ranges when downloading the movie files, and then reassemble them into ready-to-play files. This also required us to add byte range support to our uploads controller, as well as in <a href="https://github.com/ahoward/mongoid-grid_fs">Mongo gridFs driver</a>, so we could retrieve file portions efficiently. We used multi-part uploads to push files from the servers, which were preparing the movies for the appropriate S3 buckets.</p>

<p>Another advantage of dealing with file fragments was that we could parallelize both uploads and downloads to reduce the amount of time it takes to move the files around. The iPad player can download up to 4 fragments in parallel, reducing the amount of time required to download a whole file. We discovered that we could use up to 5 concurrent multipart uploads to an S3 bucket to reduce the upload time to get the media files to S3.</p>

<p>All this so you can find and download <a href="http://www.youtube.com/watch?v=ZqtNxNRCcGg">your favorite movie</a> at the airport at lightning speed and watch it on your next flight! Coming to <a href="http://www.movime.com/#!airports/c13f3">an airport near you</a> soon‚Ä¶</p>

<p><strong>this blog post by <a href="http://dojo4.com/team/fred-jean">Fred Jean</a> and <a href="http://dojo4.com/team/garett-shulman">Garett Shulman</a> and <a href="http://dojo4.com/team/corey-kohn">Corey Kohn</a></strong></p>


</div>
  </main>

  <footer>
    <hr>
<small>[ <a href="/cv">cv</a> | <a href="/io">io</a> | <a href="/jess">jess</a> | <a href="/contact">contact</a> ]</small>
  </footer>
</body>
</html>