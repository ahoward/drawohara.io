<html color-mode="user" lang="en">
  <head>
  <!-- ga -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DQVD9T27V4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DQVD9T27V4', {'debug_mode':true});
</script>

  <!-- deps -->
    <script type="module" src="/assets/js/turbo.es2017-esm.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.fuchsia.min.css"
    >

  <!-- langs -->
  <!--
    https://developers.google.com/search/docs/specialty/international/localized-versions#html
  -->
   <link rel="alternate" hreflang="en" href="/" />
   <link rel="alternate" hreflang="uk" href="https://drawohara.io/langs/uk" />
   <link rel="alternate" hreflang="sv" href="https://drawohara.io/langs/sv" />
   <link rel="alternate" hreflang="fr" href="https://drawohara.io/langs/fr" />
   <link rel="alternate" hreflang="es" href="https://drawohara.io/langs/es" />
   <link rel="alternate" hreflang="it" href="https://drawohara.io/langs/it" />

  <!-- defaults -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark" />

  <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

  <!-- meta -->
    <title>super fast embeddings with rust, javascript, ruby, ollama, and mistral.</title>

<meta property="og:title" content="super fast embeddings with rust, javascript, ruby, ollama, and mistral."/>
<meta property="og:description" content="T.I.L how to generate fast embeddings locally with open source tools" />
<meta property="og:image" content="https://drawohara.io/ro/nerd/fastest-possible-embeddings/assets/giraffe.jpeg" />


  <meta property="og:image:width" content="2048" />



  <meta property="og:image:type" content="image/jpeg" />

    <meta property="site:route" content=""/nerd/:id"">
    <meta property="site:params" content="{"ext":null,"id":"fastest-possible-embeddings"}">
    <meta property="site:path_info" content=""/fastest-possible-embeddings"">

    <style>
      /* anti pico */
      a {text-decoration: none !important; }

      @media (min-width: 768px) {
        body {
          max-width: 66%;
          margin: auto;
        }
      }

      /* anti turbo */
      html { transition: none !important; }
      .turbo-progress-bar { visibility: hidden; }

      /* anti progressive */
      html { margin: 1em; }
      img { display: block; text-align: center; }

      /* markdown shit */
      .highlighter-rouge { background: white !important; }
      .code { background: white !important; }
    </style>

    <script defer src="/assets/js/email.js"></script>
    <script defer>
      document.addEventListener("turbo:load", function() {
        const progressBar = document.querySelector('.turbo-progress-bar');
        if (progressBar) { progressBar.remove(); }
      });
    </script>
  </head>

  <body>
    <header>
      <a href="/">@drawohara</a>
&nbsp;
<small>
  <a href="mailto:i-love-this@drawohara.io?subject=/fastest-possible-embeddings">‚ù§Ô∏è </a>
    ||
  <a href="mailto:i-hate-that@drawohara.io?subject=/fastest-possible-embeddings">üñ§</a>
</small>
<hr>
    </header>

    <main>
      <div class="ro markdown">
  <h3 id="tldr">TL;DR;</h3>

<blockquote>
  <p>today i figured out the fasest possible way to generate embeddings locally with open source tools avaiable today</p>
</blockquote>

<p>i tried 4 approaches, based on <em>extensive</em> research and lots and lots of testing in my work from the past 8 mos.</p>

<p>i‚Äôve been busy building ‚Äòsocially informed AI‚Äô.   essentially, a giant,
curated, enahanced, and distilled RAG database of over a million conversations
across a thousand subreddits, domains, etc.  it‚Äôs a vast database of
a million conversations that can be brought to bear for literally <strong>ANY</strong> task
one might do with <strong>AI</strong>.</p>

<p>i have a beta program now.  ping me directly if you want an <strong>API</strong> key.  it
will be developer-first in the immediate future.  it‚Äôs a sharp tool i don‚Äôt
want used for the wrong purposes at this juncture.   a self serve product is
in the works‚Ä¶ more on that soon.</p>

<p>anyhow, let‚Äôs say i need to generate embeddings for all these conversations.
what <em>is</em> the fastest way?</p>

<p>i tried 4 methods:</p>

<ol>
  <li>ruby wrapper around <a href="https://mistral.ai/" target="_blank">https://mistral.ai/</a></li>
  <li>ruby wrapper on <a href="https://ollama.com/" target="_blank">https://ollama.com/</a></li>
  <li>rust command line program <a href="https://github.com/Anush008/fastembed-rs" target="_blank">https://github.com/Anush008/fastembed-rs</a></li>
  <li>node command line programm using <a href="https://github.com/Anush008/fastembed-js" target="_blank">https://github.com/Anush008/fastembed-js</a></li>
</ol>

<h5 id="here-is-the-ruby-code-to-generate-embeddings-with-mistral--very-short--very-easy--i-expected-this-to-be-the-slowest-although-it-took-me-only-5-minutes-to-write">here is the ruby code to generate embeddings with mistral.  very short.  very easy.  i expected this, to be the slowest, although it took me only 5 minutes to write.</h5>

<div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">#! /usr/bin/env ruby</span>
</div><div class='code-line code-line-2'>
</div><div class='code-line code-line-3'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'mistral-ai'</span>
</div><div class='code-line code-line-4'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'json'</span>
</div><div class='code-line code-line-5'>
</div><div class='code-line code-line-6'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">input</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-7'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">ARGV</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">shift</span>
</div><div class='code-line code-line-8'>
</div><div class='code-line code-line-9'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">prompt</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-10'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">input</span>&nbsp;<span style="color: #0550ae">==</span>&nbsp;<span style="color: #0a3069">'-'</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">?</span>&nbsp;<span style="color: #953800">STDIN</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">read</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">:</span>&nbsp;<span style="color: #953800">IO</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">binread</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">file</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-11'>
</div><div class='code-line code-line-12'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">mistral</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-13'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">Mistral</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">new</span><span style="color: #24292f;background-color: #f6f8fa">(</span>
</div><div class='code-line code-line-14'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0a3069">credentials: </span><span style="color: #24292f;background-color: #f6f8fa">{</span>&nbsp;<span style="color: #0a3069">api_key: </span><span style="color: #953800">ENV</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">fetch</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">'MISTRAL_API_KEY'</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">},</span>
</div><div class='code-line code-line-15'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0a3069">options: </span><span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-16'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0a3069">connection: </span><span style="color: #24292f;background-color: #f6f8fa">{</span>&nbsp;<span style="color: #0a3069">request: </span><span style="color: #24292f;background-color: #f6f8fa">{</span>&nbsp;<span style="color: #0a3069">timeout: </span><span style="color: #0550ae">420</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">},</span>
</div><div class='code-line code-line-17'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-18'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-19'>
</div><div class='code-line code-line-20'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">model</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-21'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0a3069">'mistral-embed'</span>
</div><div class='code-line code-line-22'>
</div><div class='code-line code-line-23'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">result</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-24'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">mistral</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">embeddings</span><span style="color: #24292f;background-color: #f6f8fa">(</span>
</div><div class='code-line code-line-25'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>&nbsp;<span style="color: #0a3069">model: </span><span style="color: #24292f;background-color: #f6f8fa">model</span><span style="color: #24292f;background-color: #f6f8fa">,</span>
</div><div class='code-line code-line-26'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0a3069">input: </span><span style="color: #24292f;background-color: #f6f8fa">inputs</span><span style="color: #24292f;background-color: #f6f8fa">,</span>
</div><div class='code-line code-line-27'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-28'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-29'>
</div><div class='code-line code-line-30'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedding</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-31'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">result</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">fetch</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">:data</span><span style="color: #24292f;background-color: #f6f8fa">).</span><span style="color: #8250df">fetch</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">0</span><span style="color: #24292f;background-color: #f6f8fa">).</span><span style="color: #8250df">fetch</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">:embedding</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-32'>
</div><div class='code-line code-line-33'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">json</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-34'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">JSON</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">generate</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">embedding: </span><span style="color: #24292f;background-color: #f6f8fa">embedding</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-35'>
</div><div class='code-line code-line-36'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">puts</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">json</span>
</div></code></div>
<p><br /></p>

<h5 id="next-i-installed-httpsollamacom-and-wrote-this-silly-ruby-wrapper-to-use-it--bout-3-minutes-to-write">next, i installed <a href="https://ollama.com/" target="_blank">https://ollama.com/</a> and wrote this silly ruby wrapper to use it.  bout 3 minutes to write.</h5>

<div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">#! /usr/bin/env ruby</span>
</div><div class='code-line code-line-2'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">require</span>&nbsp;<span style="color: #0a3069">'json'</span>
</div><div class='code-line code-line-3'>
</div><div class='code-line code-line-4'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">input</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-5'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">ARGV</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">shift</span>
</div><div class='code-line code-line-6'>
</div><div class='code-line code-line-7'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">prompt</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-8'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">input</span>&nbsp;<span style="color: #0550ae">==</span>&nbsp;<span style="color: #0a3069">'-'</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">?</span>&nbsp;<span style="color: #953800">STDIN</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">read</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">:</span>&nbsp;<span style="color: #953800">IO</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">binread</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">file</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-9'>
</div><div class='code-line code-line-10'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">model</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-11'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0a3069">"mxbai-embed-large"</span>
</div><div class='code-line code-line-12'>
</div><div class='code-line code-line-13'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">data</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-14'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span><span style="color: #24292f;background-color: #f6f8fa">prompt</span><span style="color: #24292f;background-color: #f6f8fa">:,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">model</span><span style="color: #24292f;background-color: #f6f8fa">:,}</span>
</div><div class='code-line code-line-15'>
</div><div class='code-line code-line-16'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">cmd</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-17'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0a3069">"curl -s 'http://localhost:11434/api/embeddings' -d '</span><span style="color: #24292f">#{</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">data</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">to_json</span>&nbsp;<span style="color: #24292f">}</span><span style="color: #0a3069">'"</span>
</div><div class='code-line code-line-18'>
</div><div class='code-line code-line-19'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">json</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-20'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">IO</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">popen</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">cmd</span><span style="color: #24292f;background-color: #f6f8fa">).</span><span style="color: #8250df">read</span>
</div><div class='code-line code-line-21'>
</div><div class='code-line code-line-22'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">puts</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">json</span>
</div></code></div>
<p><br /></p>

<h5 id="finally-i-wrote-a-rust-and-nodejavascript-version-see-below-which-were-much-longer-and-took-a-little-time-to-produce-even-with-ai-codebots-vs-code-and-a-pile-of-shit-to-install">finally, i wrote a rust and node/javascript version (see below) which were much longer and took a little time to produce, even <strong>with</strong> ai codebots, vs-code, and a pile of shit to install.</h5>

<p>the numbers.  roughly, for a 4 page document, on my linux lappy, which is pretty dang beefy but <strong>not a GPU</strong></p>

<pre><code class="language-code">drawohara@drawohara.dev:disco[main] #=&gt; cat /proc/cpuinfo | mistral-ai

The information you provided is the output from a command like `lscpu` or `cat /proc/cpuinfo` on a Linux system, detailing the specifications of each processor core in a multi-core AMD EPYC 7713 64-Core Processor. Here's a breakdown of the key details:

### General Processor Information
- **Vendor ID**: AuthenticAMD
- **Model Name**: AMD EPYC 7713 64-Core Processor
- **CPU Family**: 25
- **Model**: 1
- **Stepping**: 1
- **Microcode**: 0xa0011d1
- **CPU MHz**: 1999.999 MHz (2 GHz base frequency)
- **Cache Size**: 512 KB (L2 cache size per core)
- **Physical ID**: 0 (Indicates it is part of the same physical package)
- **Siblings**: 4 (Indicates the number of logical processors per core, due to hyper-threading)
- **CPU Cores**: 4 (Number of cores reported by this logical processor)

### Core-Specific Information
- **Core ID**: Ranges from 0 to 3 (Indicates the specific core within the physical package)
- **APIC ID**: Ranges from 0 to 3 (Advanced Programmable Interrupt Controller ID)
- **Initial APIC ID**: Ranges from 0 to 3

### CPU Features
- **Flags**:
  - Standard features: `fpu`, `vme`, `de`, `pse`, `tsc`, `msr`, `pae`, `mce`, `cx8`, `apic`, `sep`, `mtrr`, `pge`, `mca`, `cmov`, `pat`, `pse36`, `clflush`, `mmx`, `fxsr`, `sse`, `sse2`, `ss`, `ht`, `syscall`, `nx`, `pdpe1gb`, `rdtscp`, `lm`, `constant_tsc`, `rep_good`, `nopl`, `xtopology`, `nonstop_tsc`, `aperf`, `eagerfpu`, `pni`, `pclmulqdq`, `dtes64`, `monitor`, `ds_cpl`, `vmx`, `est`, `tm2`, `ssse3`, `cx16`, `xtpr`, `pdcm`, `pcid`, `sse4_1`, `sse4_2`, `x2apic`, `movbe`, `popcnt`, `tsc_deadline_timer`, `aes`, `xsave`, `avx`, `f16c`, `rdrand`, `lahf_lm`, `cmp_legacy`, `cr8_legacy`, `abm`, `sse4a`, `misalignsse`, `3dnowprefetch`, `osvw`, `skinit`, `wdt`, `nodeid_msr`, `topoext`, `perfctr_core`, `perfctr_nb`, `bpext`, `ptwrite`, `mwaitx`, `cat_l3`, `cat_l2`, `arat`, `pln`, `mce_am`, `powercnt`, `ssbd`, `ibrs`, `ibpb`, `stibp`, `vmmcall`, `fsgsbase`, `bmi1`, `hle`, `avx2`, `smep`, `bmi2`, `erms`, `invpcid`, `rtm`, `cqm`, `mpx`, `rdseed`, `adx`, `smap`, `clflushopt`, `clwb`, `sha_ni`, `xsaveopt`, `xsavec`, `xgetbv1`, `xsaves`, `avx512f`, `avx512dq`, `avx512pf`, `avx512er`, `avx512cd`, `avx512bw`, `avx512vl`, `prefetchwt1`, `clzero`, `avx512ifma`, `avx512vbmi`, `umip`, `pku`, `ospke`, `waitpkg`, `avx512_vnni`, `avx512bitalg`, `rdpid`, `fsrm`, `vaes`, `vpclmulqdq`, `arch_capabilities`
- **Bugs**: `sysret_ss_attrs`, `null_seg`, `spectre_v1`, `spectre_v2`, `spec_store_bypass`, `srso`

### Performance and Cache Information
- **BogoMIPS**: 3999.99 (A relative measure of processor speed)
- **TLB Size**: 1024 4K pages
- **Clflush Size**: 64 bytes
- **Cache Alignment**: 64 bytes
- **Address Sizes**: 48 bits physical, 48 bits virtual

### Power Management
- The output does not provide specific details on power management features, but modern CPUs like the EPYC 7713 will have various power management capabilities.

### Summary
The AMD EPYC 7713 is a high-performance server processor with 64 cores and advanced features such as SMT (Simultaneous Multi-Threading), large cache sizes, and support for a wide range of instruction sets and security features. The output shows that each physical core has 4 logical processors due to hyper-threading, and all cores are part of the same physical package. The processor operates at a base frequency of 2 GHz and includes numerous features and capabilities suitable for enterprise-level computations.
</code></pre>
<p><br /></p>

<h5 id="the-results-really-surprised-me">the results really surprised me</h5>

<ol>
  <li>ruby + remote mistral api call = ~ 1.75 seconds per embedding</li>
  <li>ruby + local ollama api call = ~ 1.5 seconds per embedding</li>
  <li>javascript + fastembed-js = ~ 0.7 seconds per embedding</li>
  <li>rust + fastembed-rs = ~ 0.3 seconds per embedding</li>
</ol>

<p>so, here is my math:</p>

<div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>
</div><div class='code-line code-line-2'><span style="color: #953800">NUMBER_CONVERSATIONS_IN_DISCO</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-3'>&nbsp;&nbsp;<span style="color: #0550ae">1_000_000</span>
</div><div class='code-line code-line-4'>
</div><div class='code-line code-line-5'><span style="color: #953800">SECONDS_PER_CONVERSATION</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-6'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">0.3</span>&nbsp;<span style="color: #0550ae">..</span>&nbsp;<span style="color: #0550ae">1.7</span><span style="color: #24292f;background-color: #f6f8fa">).</span><span style="color: #8250df">to_a</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">sample</span>
</div><div class='code-line code-line-7'>
</div><div class='code-line code-line-8'><span style="color: #953800">TOTAL_SECONDS</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-9'>&nbsp;&nbsp;<span style="color: #953800">NUMBER_CONVERSATIONS_IN_DISCO</span>&nbsp;<span style="color: #0550ae">*</span>&nbsp;<span style="color: #953800">SECONDS_PER_CONVERSATION</span>
</div><div class='code-line code-line-10'>
</div><div class='code-line code-line-11'><span style="color: #953800">TOTAL_MINUTES</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-12'>&nbsp;&nbsp;<span style="color: #953800">TOTAL_SECONDS</span>&nbsp;<span style="color: #0550ae">/</span>&nbsp;<span style="color: #0550ae">60</span>
</div><div class='code-line code-line-13'>
</div><div class='code-line code-line-14'><span style="color: #953800">TOTAL_HOURS</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-15'>&nbsp;&nbsp;<span style="color: #953800">TOTAL_MINUTES</span>&nbsp;<span style="color: #0550ae">/</span>&nbsp;<span style="color: #0550ae">60</span>
</div><div class='code-line code-line-16'>
</div><div class='code-line code-line-17'><span style="color: #953800">TOTAL_DAYS</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-18'>&nbsp;&nbsp;<span style="color: #953800">TOTAL_HOURS</span>&nbsp;<span style="color: #0550ae">/</span>&nbsp;<span style="color: #0550ae">24</span>
</div><div class='code-line code-line-19'>
</div></code></div>
<p><br /></p>

<p>basically, with rust + fastembed-js (the fastest): <strong>about 4 days run-time to do all the embeddings</strong></p>

<p>with ruby + mistral-ai (the slowest): <strong>about 20 days run-time to do all the embeddings</strong></p>

<p>so, rust is a clear winner yes?  despite a whole tool chain of depenencies needed, compilation steps, integration into ci, etc.?</p>

<blockquote>
  <h5 id="not-so-fast">NOT SO FAST</h5>
</blockquote>

<p>remember, what i showed about my machine.  for each of the approaches that run
locally, include ollama, rust, and javascript, i am</p>

<p><strong>limited by how many cpus i have</strong></p>

<p>through testing, i have found that running about 4 at a time gives the fastest throughput.  ymmv.</p>

<p>whereas, with mistral, i can run using the <code>parallel</code> gem and process <strong>20 at a time with mistral</strong>, due to API limits. and this is <em>stunningly</em> easy:</p>

<div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>
</div><div class='code-line code-line-2'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">prompts</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-3'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">[]</span>
</div><div class='code-line code-line-4'>
</div><div class='code-line code-line-5'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">rps</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-6'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">20</span>
</div><div class='code-line code-line-7'>
</div><div class='code-line code-line-8'>&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embeddings</span>&nbsp;<span style="color: #0550ae">=</span>
</div><div class='code-line code-line-9'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">Parallel</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">map</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">prompts</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">in_processes: </span><span style="color: #24292f;background-color: #f6f8fa">rps</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #cf222e">do</span>&nbsp;<span style="color: #0550ae">|</span><span style="color: #24292f;background-color: #f6f8fa">prompt</span><span style="color: #0550ae">|</span>
</div><div class='code-line code-line-10'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedding_for</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">prompt</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-11'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-12'>
</div></code></div>
<p><br /></p>

<p>yes, i <strong>do actually have a rate_limter</strong> but, since they take &gt; 1 second each that simple code actually never hits the limit ;-)</p>

<p>finally, here is <strong>the main thing</strong></p>

<blockquote>
  <p>4 days / 4</p>
</blockquote>

<p><strong>==</strong></p>

<blockquote>
  <p>20 days / 20</p>
</blockquote>

<p>because math.</p>

<p>and, actually, with batching i can make the mistral version quite a bit faster, about 10x.</p>

<p>so the moral is this</p>

<blockquote>
  <p>the simplest and easiest solution was the best.</p>
</blockquote>

<p>and</p>

<blockquote>
  <p>premature optimization is the root of all evil.</p>
</blockquote>

<p>someone <a href="https://wiki.c2.com/?PrematureOptimization">very clever once said that^^^^^!</a></p>

<p>in nearly 30 years doing both big, and i mean <a href="/nerd">really big</a> data and science with ruby, i have yet to meet a better <a href="https://en.wikipedia.org/wiki/Very_high-level_programming_language">VHLL</a> to model my abstractions in, and to get shit done <strong>FAST</strong></p>

<p>for sure, i occasionally will need to drop into rust or c but, those cases, are more rare than you might think and, often, reaching for the ‚Äòbig guns‚Äô too fast just wastes time.</p>

<p>certainly, anything in-between a VHLL and a compiled lang is a waste of time,
money, and effort.  here‚Äôs looking at you javascript and pythong (ssss üêç)!  haha ;-)</p>

<p>ps.  because i can hear you thinking</p>

<blockquote>
  <p>i can call APIs in pythong (üêçüêçüêçüêçsssss) and js too</p>
</blockquote>

<p>and, of course, this is true.   especially if you enjoy worst-in-history
dependency management, security issues, version churn, and really really like
writing 10x the LOC to accomplish the same damn thing that still blow up with
horrible stack traces of parallism in production your dev-ops team (fire them)
still can‚Äôt figure out no matter how many parameters they tune.</p>

<p>next article is about dependency <strong>hell</strong> in pythong.  the time i worked at a
‚Äúreally great firm‚Äù that was ‚Äúexpert in python‚Äù (ssssss üêçüêçüêçüêçüêç) and showed
them that, depsite 4 months of trying by thier principals, they could not
manage to have fewer than 4 versions of python running in CI and <strong>no one
even knew</strong>.  but i will save that rant, for another day.</p>

</div>


<br>

  <ul>
    <li>
      <a href='/ro/nerd/fastest-possible-embeddings/assets/src/fastembed.js'>./fastembed.js</a>
      <details>
        <summary><small><a name='./fastembed.js'>&mdash;&gt; view source</a></small></summary>
        <div class="ro markdown src">
  <code class='code' style='white-space:pre;'><div class='code-line code-line-1'><span style="color: #6e7781">#! /usr/bin/env node</span>
</div><div class='code-line code-line-2'>
</div><div class='code-line code-line-3'><span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">fs</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #8250df">require</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">'</span><span style="color: #0a3069">fs</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-4'><span style="color: #6e7781">//const { FastEmbed } = require('fastembed');</span>
</div><div class='code-line code-line-5'><span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">EmbeddingModel</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">FlagEmbedding</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #8250df">require</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">'</span><span style="color: #0a3069">fastembed</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-6'>
</div><div class='code-line code-line-7'><span style="color: #6e7781">// Function to read input file</span>
</div><div class='code-line code-line-8'><span style="color: #cf222e">function</span>&nbsp;<span style="color: #8250df">readInputFile</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">inputPath</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-9'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if </span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">inputPath</span>&nbsp;<span style="color: #0550ae">===</span>&nbsp;<span style="color: #0a3069">'</span><span style="color: #0a3069">-</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-10'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">return</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">fs</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">readFileSync</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">'</span><span style="color: #0a3069">/dev/stdin</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">'</span><span style="color: #0a3069">utf8</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-11'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>&nbsp;<span style="color: #cf222e">else</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-12'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">return</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">fs</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">readFileSync</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">inputPath</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">'</span><span style="color: #0a3069">utf8</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-13'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-14'><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-15'>
</div><div class='code-line code-line-16'><span style="color: #6e7781">// Function to write output file</span>
</div><div class='code-line code-line-17'><span style="color: #cf222e">function</span>&nbsp;<span style="color: #8250df">writeOutputFile</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">outputPath</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">data</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-18'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if </span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">outputPath</span>&nbsp;<span style="color: #0550ae">===</span>&nbsp;<span style="color: #0a3069">'</span><span style="color: #0a3069">-</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-19'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">process</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #24292f;background-color: #f6f8fa">stdout</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">write</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">data</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-20'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>&nbsp;<span style="color: #cf222e">else</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-21'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">fs</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">writeFileSync</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">outputPath</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">data</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">'</span><span style="color: #0a3069">utf8</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-22'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-23'><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-24'>
</div><div class='code-line code-line-25'><span style="color: #6e7781">// Main function</span>
</div><div class='code-line code-line-26'><span style="color: #cf222e">async</span>&nbsp;<span style="color: #cf222e">function</span>&nbsp;<span style="color: #8250df">main</span><span style="color: #24292f;background-color: #f6f8fa">()</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-27'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">args</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">process</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #24292f;background-color: #f6f8fa">argv</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">slice</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">2</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-28'>
</div><div class='code-line code-line-29'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if </span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">args</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #24292f;background-color: #f6f8fa">length</span>&nbsp;<span style="color: #0550ae">!==</span>&nbsp;<span style="color: #0550ae">2</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-30'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">console</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">error</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">'</span><span style="color: #0a3069">Usage: node program.js &lt;input&gt; &lt;output&gt;</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-31'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">process</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">exit</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">42</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-32'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-33'>
</div><div class='code-line code-line-34'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">inputPath</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">outputPath</span><span style="color: #24292f;background-color: #f6f8fa">]</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">args</span><span style="color: #24292f;background-color: #f6f8fa">;</span>
</div><div class='code-line code-line-35'>
</div><div class='code-line code-line-36'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">try</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-37'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">inputText</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #8250df">readInputFile</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">inputPath</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-38'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//const embedder = new FastEmbed();</span>
</div><div class='code-line code-line-39'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedder</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #cf222e">await</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">FlagEmbedding</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">init</span><span style="color: #24292f;background-color: #f6f8fa">({</span>
</div><div class='code-line code-line-40'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #116329">model</span><span style="color: #24292f;background-color: #f6f8fa">:</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">EmbeddingModel</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #24292f;background-color: #f6f8fa">BGEBaseEN</span>
</div><div class='code-line code-line-41'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">});</span>
</div><div class='code-line code-line-42'>
</div><div class='code-line code-line-43'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">documents</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">inputText</span><span style="color: #24292f;background-color: #f6f8fa">];</span>
</div><div class='code-line code-line-44'>
</div><div class='code-line code-line-45'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embeddings</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #cf222e">await</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedder</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">embed</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">documents</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-46'>
</div><div class='code-line code-line-47'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">for</span>&nbsp;<span style="color: #cf222e">await </span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">batch</span>&nbsp;<span style="color: #cf222e">of</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embeddings</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-48'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">// batch is list of Float32 embeddings(number[][]) with length 2</span>
</div><div class='code-line code-line-49'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//console.dir(batch);</span>
</div><div class='code-line code-line-50'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedding</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">batch</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0550ae">0</span><span style="color: #24292f;background-color: #f6f8fa">];</span>
</div><div class='code-line code-line-51'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">const</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embeddingString</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #0a3069">"</span><span style="color: #0a3069">[</span><span style="color: #0a3069">\n</span><span style="color: #0a3069">"</span>&nbsp;<span style="color: #0550ae">+</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedding</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">join</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"</span><span style="color: #0a3069">,</span><span style="color: #0a3069">\n</span><span style="color: #0a3069">"</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #0550ae">+</span>&nbsp;<span style="color: #0a3069">"</span><span style="color: #0a3069">\n</span><span style="color: #0a3069">]</span><span style="color: #0a3069">\n</span><span style="color: #0a3069">"</span><span style="color: #24292f;background-color: #f6f8fa">;</span>
</div><div class='code-line code-line-52'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//const embeddingString = JSON.stringify(embedding);</span>
</div><div class='code-line code-line-53'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">writeOutputFile</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">outputPath</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embeddingString</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-54'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">process</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">exit</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">0</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-55'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">};</span>
</div><div class='code-line code-line-56'>
</div><div class='code-line code-line-57'><span style="color: #6e7781">//debugger;</span>
</div><div class='code-line code-line-58'><span style="color: #6e7781">//console.dir(embedding);</span>
</div><div class='code-line code-line-59'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//const embeddingString = embedding.join(',');</span>
</div><div class='code-line code-line-60'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//writeOutputFile(outputPath, embeddingString);</span>
</div><div class='code-line code-line-61'>
</div><div class='code-line code-line-62'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//process.exit(0);</span>
</div><div class='code-line code-line-63'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>&nbsp;<span style="color: #cf222e">catch </span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">error</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-64'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">console</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">error</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">'</span><span style="color: #0a3069">Error:</span><span style="color: #0a3069">'</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">error</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #24292f;background-color: #f6f8fa">message</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-65'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">process</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">exit</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">1</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-66'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-67'><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-68'>
</div><div class='code-line code-line-69'><span style="color: #8250df">main</span><span style="color: #24292f;background-color: #f6f8fa">();</span>
</div><div class='code-line code-line-70'>
</div></code>
</div>

      </details>
    </li>
  </ul>

  <ul>
    <li>
      <a href='/ro/nerd/fastest-possible-embeddings/assets/src/fastembed.rs'>./fastembed.rs</a>
      <details>
        <summary><small><a name='./fastembed.rs'>&mdash;&gt; view source</a></small></summary>
        <div class="ro markdown src">
  <code class='code' style='white-space:pre;'><div class='code-line code-line-1'><span style="color: #cf222e">use</span>&nbsp;<span style="color: #953800">fastembed</span><span style="color: #24292f;background-color: #f6f8fa">::{</span><span style="color: #24292f;background-color: #f6f8fa">TextEmbedding</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">InitOptions</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">EmbeddingModel</span><span style="color: #24292f;background-color: #f6f8fa">};</span>
</div><div class='code-line code-line-2'><span style="color: #cf222e">use</span>&nbsp;<span style="color: #953800">serde</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #24292f;background-color: #f6f8fa">Serialize</span><span style="color: #24292f;background-color: #f6f8fa">;</span>
</div><div class='code-line code-line-3'><span style="color: #cf222e">use</span>&nbsp;<span style="color: #953800">std</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #24292f;background-color: #f6f8fa">env</span><span style="color: #24292f;background-color: #f6f8fa">;</span>
</div><div class='code-line code-line-4'><span style="color: #cf222e">use</span>&nbsp;<span style="color: #953800">std</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #24292f;background-color: #f6f8fa">fs</span><span style="color: #24292f;background-color: #f6f8fa">;</span>
</div><div class='code-line code-line-5'>
</div><div class='code-line code-line-6'><span style="color: #8250df">#[derive(Serialize)]</span>
</div><div class='code-line code-line-7'><span style="color: #cf222e">struct</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">EmbeddingOutput</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-8'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedding</span><span style="color: #24292f;background-color: #f6f8fa">:</span>&nbsp;<span style="color: #953800">String</span><span style="color: #24292f;background-color: #f6f8fa">,</span>
</div><div class='code-line code-line-9'><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-10'>
</div><div class='code-line code-line-11'><span style="color: #cf222e">fn</span>&nbsp;<span style="color: #8250df">main</span><span style="color: #24292f;background-color: #f6f8fa">()</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-12'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">args</span><span style="color: #24292f;background-color: #f6f8fa">:</span>&nbsp;<span style="color: #953800">Vec</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">String</span><span style="color: #0550ae">&gt;</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">env</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">args</span><span style="color: #24292f;background-color: #f6f8fa">()</span><span style="color: #8250df">.collect</span><span style="color: #24292f;background-color: #f6f8fa">();</span>
</div><div class='code-line code-line-13'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">args</span><span style="color: #8250df">.len</span><span style="color: #24292f;background-color: #f6f8fa">()</span>&nbsp;<span style="color: #0550ae">!=</span>&nbsp;<span style="color: #0550ae">3</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-14'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">eprintln!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"Usage: {} &lt;input_file&gt; &lt;output_file&gt;"</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">args</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0550ae">0</span><span style="color: #24292f;background-color: #f6f8fa">]);</span>
</div><div class='code-line code-line-15'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">std</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #953800">process</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">exit</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">1</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-16'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-17'>
</div><div class='code-line code-line-18'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">input_file</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #0550ae">&amp;</span><span style="color: #24292f;background-color: #f6f8fa">args</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0550ae">1</span><span style="color: #24292f;background-color: #f6f8fa">];</span>
</div><div class='code-line code-line-19'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">output_file</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #0550ae">&amp;</span><span style="color: #24292f;background-color: #f6f8fa">args</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0550ae">2</span><span style="color: #24292f;background-color: #f6f8fa">];</span>
</div><div class='code-line code-line-20'>
</div><div class='code-line code-line-21'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">input_text</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #cf222e">match</span>&nbsp;<span style="color: #953800">fs</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">read_to_string</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">input_file</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-22'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">Ok</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">content</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #cf222e">=&gt;</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">content</span><span style="color: #24292f;background-color: #f6f8fa">,</span>
</div><div class='code-line code-line-23'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">Err</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">e</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #cf222e">=&gt;</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-24'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">eprintln!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"Error reading input file: {}"</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">e</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-25'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">std</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #953800">process</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">exit</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">1</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-26'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-27'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">};</span>
</div><div class='code-line code-line-28'>
</div><div class='code-line code-line-29'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">model</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">TextEmbedding</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">try_new</span><span style="color: #24292f;background-color: #f6f8fa">(</span>
</div><div class='code-line code-line-30'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">InitOptions</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">new</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #953800">EmbeddingModel</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #24292f;background-color: #f6f8fa">AllMiniLML6V2</span><span style="color: #24292f;background-color: #f6f8fa">)</span><span style="color: #8250df">.with_show_download_progress</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #cf222e">true</span><span style="color: #24292f;background-color: #f6f8fa">),</span>
</div><div class='code-line code-line-31'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">)</span><span style="color: #8250df">.expect</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"Failed to initialize the embedding model"</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-32'>
</div><div class='code-line code-line-33'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">documents</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #8250df">vec!</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #24292f;background-color: #f6f8fa">input_text</span><span style="color: #24292f;background-color: #f6f8fa">];</span>
</div><div class='code-line code-line-34'>
</div><div class='code-line code-line-35'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embeddings</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #cf222e">match</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">model</span><span style="color: #8250df">.embed</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">documents</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #953800">None</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-36'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">Ok</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">embeddings</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #cf222e">=&gt;</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embeddings</span><span style="color: #24292f;background-color: #f6f8fa">,</span>
</div><div class='code-line code-line-37'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">Err</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">e</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #cf222e">=&gt;</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-38'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">eprintln!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"Error generating embedding: {}"</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">e</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-39'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">std</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #953800">process</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">exit</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">1</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-40'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-41'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">};</span>
</div><div class='code-line code-line-42'>
</div><div class='code-line code-line-43'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">_embedding</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embeddings</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0550ae">0</span><span style="color: #24292f;background-color: #f6f8fa">][</span><span style="color: #0550ae">0</span><span style="color: #24292f;background-color: #f6f8fa">];</span>
</div><div class='code-line code-line-44'>
</div><div class='code-line code-line-45'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">_embedding_str</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embeddings</span><span style="color: #24292f;background-color: #f6f8fa">[</span><span style="color: #0550ae">0</span><span style="color: #24292f;background-color: #f6f8fa">]</span>
</div><div class='code-line code-line-46'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">.iter</span><span style="color: #24292f;background-color: #f6f8fa">()</span>
</div><div class='code-line code-line-47'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">.map</span><span style="color: #24292f;background-color: #f6f8fa">(|</span><span style="color: #24292f;background-color: #f6f8fa">f</span><span style="color: #24292f;background-color: #f6f8fa">|</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">f</span><span style="color: #8250df">.to_string</span><span style="color: #24292f;background-color: #f6f8fa">())</span>
</div><div class='code-line code-line-48'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">.collect</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #0550ae">&lt;</span><span style="color: #953800">Vec</span><span style="color: #0550ae">&lt;</span><span style="color: #24292f;background-color: #f6f8fa">_</span><span style="color: #0550ae">&gt;&gt;</span><span style="color: #24292f;background-color: #f6f8fa">()</span>
</div><div class='code-line code-line-49'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">.join</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">","</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-50'>
</div><div class='code-line code-line-51'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedding_str</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #8250df">format!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"{}{}{}"</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">"["</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">_embedding_str</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #0a3069">"]"</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-52'>
</div><div class='code-line code-line-53'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">json</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">serde_json</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">to_string</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">&amp;</span><span style="color: #24292f;background-color: #f6f8fa">EmbeddingOutput</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-54'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedding</span><span style="color: #24292f;background-color: #f6f8fa">:</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">embedding_str</span><span style="color: #24292f;background-color: #f6f8fa">,</span>
</div><div class='code-line code-line-55'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">})</span><span style="color: #8250df">.unwrap</span><span style="color: #24292f;background-color: #f6f8fa">();</span>
</div><div class='code-line code-line-56'>
</div><div class='code-line code-line-57'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//match fs::write(output_file, json) {</span>
</div><div class='code-line code-line-58'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//Ok(_) | Err(_) =&gt; todo!(),</span>
</div><div class='code-line code-line-59'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//Ok(_) =&gt; eprintln!("Embedding written to {}", output_file),</span>
</div><div class='code-line code-line-60'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//Err(e) =&gt; eprintln!("Error writing to output file: {}", e),</span>
</div><div class='code-line code-line-61'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781">//}</span>
</div><div class='code-line code-line-62'>
</div><div class='code-line code-line-63'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #cf222e">let</span>&nbsp;<span style="color: #8250df">Err</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">e</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #953800">fs</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">write</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #24292f;background-color: #f6f8fa">output_file</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">json</span><span style="color: #24292f;background-color: #f6f8fa">)</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">{</span>
</div><div class='code-line code-line-64'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #8250df">eprintln!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0a3069">"Error writing to output file: {}"</span><span style="color: #24292f;background-color: #f6f8fa">,</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">e</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-65'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #953800">std</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #953800">process</span><span style="color: #24292f;background-color: #f6f8fa">::</span><span style="color: #8250df">exit</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">1</span><span style="color: #24292f;background-color: #f6f8fa">);</span>
</div><div class='code-line code-line-66'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-67'><span style="color: #24292f;background-color: #f6f8fa">}</span>
</div><div class='code-line code-line-68'>
</div></code>
</div>

      </details>
    </li>
  </ul>
    </main>

    <footer>
      <hr>
<a href="/goto" name="goto">&mdash;&gt; goto</a>
<blockquote>

be kind whenever possible.  it is always possible.
 <br> <br> &nbsp;&mdash; h.h. the 14th dalai lama
</blockquote>
<a href="/">&lt;&mdash; eject</a>
    </footer>
  </body>
</html>