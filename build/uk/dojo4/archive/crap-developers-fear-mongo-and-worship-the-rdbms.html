<html color-mode="user" lang="uk">
  <head>
  <base href='/uk' />
  <!-- ga -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DQVD9T27V4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DQVD9T27V4');
</script>

  <!-- deps -->
    <script type="module" src="/assets/js/turbo.es2017-esm.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.fluid.classless.fuchsia.min.css"
    >

  <!-- defaults -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="color-scheme" content="light dark" />

  <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

  <!-- meta -->
    <title>Розробники-Невдахи Бояться Mongo та Поклоняються RDBMS</title>

<meta property="og:title" content="Розробники-Невдахи Бояться Mongo та Поклоняються RDBMS"/>
<meta property="og:description" content="переходь далі." />
<meta property="og:image" content="https://drawohara.io/media/mick.jpg" />

<meta property="og:image:type" content="image/jpeg" />

    <meta property="site:route" content="/dojo4/archive/:id">
    <meta property="site:params" content='{"ext":null,"id":"crap-developers-fear-mongo-and-worship-the-rdbms"}'>
    <meta property="site:path_info" content="/crap-developers-fear-mongo-and-worship-the-rdbms">

    <style>
      /* anti pico */
      a {text-decoration: none !important; }

      /* anti turbo */
      html { transition: none !important; }
      .turbo-progress-bar { visibility: hidden; }

      /* anti progressive */
      html { margin: 1em; }
      img { display: block; text-align: center; }
    </style>

    <script>
      document.addEventListener("turbo:load", function() {
        const progressBar = document.querySelector('.turbo-progress-bar');
        if (progressBar) {
          progressBar.remove();
        }
      });
    </script>
  </head>

  <body>
    <header>
      <a href="/home">@drawohara</a>
<hr>
    </header>

    <main>
      <div class="ro markdown">
  <h3 id="tl-dr">TL; DR;</h3>

<blockquote>
  <p>99.9% веб-розробників у світі вважають, що правильне використання RDBMS разом з транзакціями запобігає появі поганих даних та серйозних помилок якості даних у їхніх застосунках. Вони <em>ПОМИЛЯЮТЬСЯ</em> <em>ЗАВСІГДИ</em>.</p>
</blockquote>

<p>З великим інтересом я прочитав чудову статтю <a href="https://github.com/aphyr">Кайла Кінгсбері</a> про модель консистенції Mongo на https://aphyr.com/posts/322-call-me-maybe-mongodb-stale-reads</p>

<p>Очевидно, що цей хлопець дуже розумний і знає свою справу. Він робить роботу, і все в цій статті є цікавим і добре організованим.</p>

<p>Але мене здивували коментарі та те, що вони розповідають про середнього професійного розробника:</p>

<blockquote>
  <p>Розробники вважають, що використання RDBMS робить їхні дані безпечними, і вони <em>абсолютно неправі</em></p>
</blockquote>

<p>Я не можу сказати, скільки разів я сперечався з "професійними" розробниками та особливо дурними сисадмінами, які дійсно вірять, що, просто сказавши слово RDBMS, обертаючи курку три рази навколо голови та підключаючись до магічного єдинорога з баз даних, їхні дані будуть в безпеці та у безпеці, як, знаєте, ... (щось-щось про) ... банківські транзакції та все той дріб (нісенітниця) про транзакції та fsync. І купа іншого, про що жоден розробник, з яким я коли-небудь зустрічався, не зрозумів або не розглядав у контексті HTTP-застосунку (підказка: без стану).</p>

<p>Перш ніж продовжувати, я викидаю виклик:</p>

<ul>
  <li>Надішліть мені свій обліковий запис GitHub</li>
  <li>Дозвольте мені вибрати застосунок на базі MySQL або PostgreSQL, який ви написали (щоб ви не могли його підготувати)</li>
  <li>І я знайду шляхи коду, які забезпечують як читання непідтверджених, так і брудні читання в вашому застосунку протягом 1 дня</li>
  <li>Якщо таких немає, я заплачу вам <em>$1000 баксів</em></li>
  <li>Якщо є хоча б один, я зможу опублікувати будь-яке зображення, яке виберу, як додаток до цієї статті. Фотошоп <em>дозволено</em>.</li>
</ul>

<p>Знайдіть мене на <a href="/contact">/contact</a> або <a href="/team/ara-t-howard">/team/ara-t-howard</a>. А тепер далі...</p>

<p>Розгадай, розробник: що не так з цим шляхом коду:</p>

<div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>
</div><div class='code-line code-line-2'>&nbsp;&nbsp;<span style="color: #0550ae">@db</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">transaction</span>&nbsp;<span style="color: #cf222e">do</span>
</div><div class='code-line code-line-3'>
</div><div class='code-line code-line-4'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">no_user_exists_with_conditions?</span>
</div><div class='code-line code-line-5'>
</div><div class='code-line code-line-6'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@user</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">make_that_user_exists_with_those_conditions!</span>
</div><div class='code-line code-line-7'>
</div><div class='code-line code-line-8'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">deliver_an_activation_email_to!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">@user</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-9'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-10'>
</div><div class='code-line code-line-11'>&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-12'>
</div><div class='code-line code-line-13'>
</div></code></div>

<p>Дозвольте мені відкрити вам щось землетрусне:</p>

<p><strong>ЦЕЙ КОД АБСОЛЮТНО ЗЛАМАНИЙ НА ВСІХ ОСНОВНИХ <em>RDBMS</em>, ТА ВІРТУАЛЬНО ВСЬОМУ<br />
ЗАСТОСУВАННЮ В СВІТІ</strong></p>

<p>Я запевняю вас, що електронний лист піде <em>двічі</em>.</p>

<p>Пояснення транзакцій виходить за межі цієї статті, але дозвольте мені представити вам "фантомні читання"</p>

<p>http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Phantom_reads</p>

<p>У вищезгаданому коді друга, паралельна транзакція може спричинити наступне:</p>

<div class="language-ruby highlighter-rouge"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>
</div><div class='code-line code-line-2'>&nbsp;&nbsp;<span style="color: #0550ae">@db</span><span style="color: #24292f;background-color: #f6f8fa">.</span><span style="color: #8250df">transaction</span>&nbsp;<span style="color: #cf222e">do</span>
</div><div class='code-line code-line-3'>
</div><div class='code-line code-line-4'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">if</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">no_user_exists_with_conditions?</span>
</div><div class='code-line code-line-5'>
</div><div class='code-line code-line-6'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># тим часом, друга транзакція створила дубльованого користувача...</span>
</div><div class='code-line code-line-7'>
</div><div class='code-line code-line-8'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># наступне пройде успішно в обох транзакціях</span>
</div><div class='code-line code-line-9'>
</div><div class='code-line code-line-10'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0550ae">@user</span>&nbsp;<span style="color: #0550ae">=</span>&nbsp;<span style="color: #24292f;background-color: #f6f8fa">make_that_user_exists_with_those_conditions!</span>
</div><div class='code-line code-line-11'>
</div><div class='code-line code-line-12'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #6e7781"># обидві транзакції відправлять листи</span>
</div><div class='code-line code-line-13'>
</div><div class='code-line code-line-14'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #24292f;background-color: #f6f8fa">deliver_an_activation_email_to!</span><span style="color: #24292f;background-color: #f6f8fa">(</span><span style="color: #0550ae">@user</span><span style="color: #24292f;background-color: #f6f8fa">)</span>
</div><div class='code-line code-line-15'>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-16'>
</div><div class='code-line code-line-17'>&nbsp;&nbsp;<span style="color: #cf222e">end</span>
</div><div class='code-line code-line-18'>
</div><div class='code-line code-line-19'>&nbsp;&nbsp;<span style="color: #6e7781"># одна з транзакцій не вдасться виконати та вибухне, але до того часу</span>
</div><div class='code-line code-line-20'>&nbsp;&nbsp;<span style="color: #6e7781"># буде запізніло: лист відправлено двічі, а помилку вже зроблено</span>
</div><div class='code-line code-line-21'>
</div><div class='code-line code-line-22'>
</div></code></div>

<p>Я знаю, ви не можете в це повірити. Але це лише тому, що ви ніколи не потрудилися прочитати документацію щодо того, що означає "транзакція". Почніть тут:</p>

<p>http://www.postgresql.org/docs/9.1/static/transaction-iso.html</p>

<p>Зверніть увагу на цю маленьку таблицю. Дозвольте мені перекласти її для вас:</p>

<ul>
  <li>
    <p>Тому що <em>ви</em> не маєте кожну <em>єдину</em> послідовність <em>читання та запису</em>, обгорнуту в транзакцію, і іноді просто закидуєте код проти ваших ORM-об'єктів безпосередньо, ви страждаєте від "жахливої" реальності "читання непідтверджених", згаданої в статті</p>
  </li>
  <li>
    <p>Тому що <em>ви</em> покладаєтеся на рівень ізоляції за замовчуванням, ви страждаєте від обох неповторюваних читань та фантомних читань. (Чи знаєте ви, яким є рівень ізоляції за замовчуванням для вашої бази даних і що це означає????)</p>
  </li>
  <li>
    <p>Тому що <em>ви</em> не встановили рівень транзакції на "серіалізований", ви помилково вважаєте, що ваша база даних швидка та безпечна. Ви помилково покладалися на базу даних для забезпечення цілісності даних як абстракцію, яка не вимагає критичного мислення та коду застосунку, який принаймні в 10 разів кращий за ваш. Ви маєте всі жахливі функції із статті Кайла у ваших застосунках на базі RDBMS - і, не тільки ви <em>не знаєте про це</em>, але ви <em>дуже впевнені, що ваші дані "безпечні"</em></p>
  </li>
</ul>

<p>Тож я запитую вас, яке рішення гірше з інженерної точки зору:</p>

<ul>
  <li>
    <p>Обрати інструмент на основі стандартів, у якому всі <em>дуже</em> впевнені, що вони розуміють і знають, як безпечно використовувати, але в звичайному використанні він практично ніколи не гарантує те, що, як вони вважають, він обіцяє, і, крім того, широко <a href="http://en.wikipedia.org/wiki/Isolation_%28database_systems%29#Default_isolation_level">критикується за неоднозначну та неточну семантику</a>?</p>
  </li>
  <li>
    <p>Чи прийняти те, що завжди було правдою: що бази даних самі по собі не можуть надати абстракції, які означають, що не надзвичайно розумні розробники не можуть легко все зіпсувати. І що цілісність даних є специфічною для домену концепцією, яка повинна бути реалізована на рівні застосунку, лише невелика частина цієї цілісності підтримується вибором бази даних.</p>
  </li>
</ul>

<p>ps. Я працював над великомасштабними фінансовими, реальночасовими та високодоступними системами, які використовують як Mongo, так і PostgreSQL. Це дуже складно в будь-якому випадку.</p>

<p>pss. Я намагався прокоментувати ваш блог, Кайл, але коментарі вибухнули ;-)</p>

<p><img src="https://s3.amazonaws.com/ss.dojo4.com/JKeSPdp46a4R3paZkp6oo7X1b7QNhI6hQN4kp1QPx3ZYqn3exRzqht0.png" style="max-width:200px;" /></p>

</div>
    </main>

    <footer>
      <hr>
<a href="/goto" name="goto">&mdash;&gt; goto</a>
<blockquote>
<ul>
  <li>
    <a href="/about">про нас<a>
  </li>
  <li>
    <a href="mailto:i-hate-this@drawohara.io?subject=/crap-developers-fear-mongo-and-worship-the-rdbms">i-hate-this<a>
  </li>
  <li>
    <a href="mailto:i-love-this@drawohara.io?subject=/crap-developers-fear-mongo-and-worship-the-rdbms">i-love-this<a>
  </li>
  <li>
    <a href="/contact">контакти<a>
  </li>
</ul>
</blockquote>
<a href="/">&lt;&mdash; eject</a>
    </footer>
  </body>
</html>