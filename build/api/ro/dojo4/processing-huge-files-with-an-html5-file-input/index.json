{
  "data": {
    "dojo4/processing-huge-files-with-an-html5-file-input": {
      "title": "Processing HUGE files with an html5 file input",
      "published_at": "2012-12-28 00:00:00 UTC",
      "author": "ara@dojo4.com",
      "body": "<div class=\"ro markdown\">\n  <p>I was playing with some code that required processing a huge file (&gt; 600 mb) with an html5 file input type.  It took some playing before I discovered how to process a huge file without crashing the browser.  Hereâ€™s the gist of it:</p>\n\n<div class=\"language-html highlighter-rouge\"><code class='code' style='white-space:pre;'><div class='code-line code-line-1'>\n</div><div class='code-line code-line-2'>&nbsp;&nbsp;<span style=\"color: #6e7781\">&lt;!--</span>\n</div><div class='code-line code-line-3'>\n</div><div class='code-line code-line-4'><span style=\"color: #6e7781\">  doing a large chunked upload of content using html5's file input feature is tricky.</span>\n</div><div class='code-line code-line-5'><span style=\"color: #6e7781\">  </span>\n</div><div class='code-line code-line-6'><span style=\"color: #6e7781\">  this simple example should help you out.</span>\n</div><div class='code-line code-line-7'>\n</div><div class='code-line code-line-8'><span style=\"color: #6e7781\">--&gt;</span>\n</div><div class='code-line code-line-9'>\n</div><div class='code-line code-line-10'><span style=\"color: #116329\">&lt;br&gt;</span>\n</div><div class='code-line code-line-11'><span style=\"color: #116329\">&lt;br&gt;</span>\n</div><div class='code-line code-line-12'><span style=\"color: #116329\">&lt;br&gt;</span>\n</div><div class='code-line code-line-13'><span style=\"color: #116329\">&lt;hr&gt;</span>\n</div><div class='code-line code-line-14'>\n</div><div class='code-line code-line-15'><span style=\"color: #116329\">&lt;center&gt;</span>\n</div><div class='code-line code-line-16'>&nbsp;&nbsp;<span style=\"color: #116329\">&lt;blink&gt;</span>\n</div><div class='code-line code-line-17'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #116329\">&lt;input</span>&nbsp;<span style=\"color: #116329\">type=</span><span style=\"color: #0a3069\">'file'</span>&nbsp;<span style=\"color: #116329\">name=</span><span style=\"color: #0a3069\">'file'</span>&nbsp;<span style=\"color: #116329\">id=</span><span style=\"color: #0a3069\">'file'</span>&nbsp;<span style=\"color: #116329\">/&gt;</span>\n</div><div class='code-line code-line-18'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #116329\">&lt;br&gt;</span>\n</div><div class='code-line code-line-19'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #116329\">&lt;div</span>&nbsp;<span style=\"color: #116329\">id=</span><span style=\"color: #0a3069\">'progress'</span>&nbsp;<span style=\"color: #116329\">/&gt;</span>\n</div><div class='code-line code-line-20'>&nbsp;&nbsp;<span style=\"color: #116329\">&lt;/blink&gt;</span>\n</div><div class='code-line code-line-21'><span style=\"color: #116329\">&lt;/center&gt;</span>\n</div><div class='code-line code-line-22'>\n</div><div class='code-line code-line-23'><span style=\"color: #116329\">&lt;script&gt;</span>\n</div><div class='code-line code-line-24'>&nbsp;&nbsp;<span style=\"color: #8250df\">jQuery</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #0a3069\">'</span><span style=\"color: #0a3069\">#file</span><span style=\"color: #0a3069\">'</span><span style=\"color: #24292f;background-color: #f6f8fa\">).</span><span style=\"color: #8250df\">change</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #cf222e\">function</span><span style=\"color: #24292f;background-color: #f6f8fa\">(){</span>\n</div><div class='code-line code-line-25'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">file</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #953800\">document</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">getElementById</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #0a3069\">'</span><span style=\"color: #0a3069\">file</span><span style=\"color: #0a3069\">'</span><span style=\"color: #24292f;background-color: #f6f8fa\">).</span><span style=\"color: #24292f;background-color: #f6f8fa\">files</span><span style=\"color: #24292f;background-color: #f6f8fa\">[</span><span style=\"color: #0550ae\">0</span><span style=\"color: #24292f;background-color: #f6f8fa\">];</span>\n</div><div class='code-line code-line-26'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">progress</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #8250df\">jQuery</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #0a3069\">'</span><span style=\"color: #0a3069\">#progress</span><span style=\"color: #0a3069\">'</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-27'>\n</div><div class='code-line code-line-28'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">if</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #24292f;background-color: #f6f8fa\">file</span><span style=\"color: #24292f;background-color: #f6f8fa\">){</span>\n</div><div class='code-line code-line-29'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">reader</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #cf222e\">new</span>&nbsp;<span style=\"color: #953800\">FileReader</span><span style=\"color: #24292f;background-color: #f6f8fa\">();</span>\n</div><div class='code-line code-line-30'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">size</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">file</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #24292f;background-color: #f6f8fa\">size</span><span style=\"color: #24292f;background-color: #f6f8fa\">;</span>\n</div><div class='code-line code-line-31'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">chunk_size</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #953800\">Math</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">pow</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #0550ae\">2</span><span style=\"color: #24292f;background-color: #f6f8fa\">,</span>&nbsp;<span style=\"color: #0550ae\">13</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-32'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">chunks</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">[];</span>\n</div><div class='code-line code-line-33'>\n</div><div class='code-line code-line-34'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">offset</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #0550ae\">0</span><span style=\"color: #24292f;background-color: #f6f8fa\">;</span>\n</div><div class='code-line code-line-35'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">bytes</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #0550ae\">0</span><span style=\"color: #24292f;background-color: #f6f8fa\">;</span>\n</div><div class='code-line code-line-36'>\n</div><div class='code-line code-line-37'>\n</div><div class='code-line code-line-38'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">reader</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #24292f;background-color: #f6f8fa\">onloadend</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #cf222e\">function</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #24292f;background-color: #f6f8fa\">e</span><span style=\"color: #24292f;background-color: #f6f8fa\">){</span>\n</div><div class='code-line code-line-39'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">if </span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #24292f;background-color: #f6f8fa\">e</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #24292f;background-color: #f6f8fa\">target</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #24292f;background-color: #f6f8fa\">readyState</span>&nbsp;<span style=\"color: #0550ae\">==</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">FileReader</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #24292f;background-color: #f6f8fa\">DONE</span><span style=\"color: #24292f;background-color: #f6f8fa\">){</span>\n</div><div class='code-line code-line-40'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">chunk</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">e</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #24292f;background-color: #f6f8fa\">target</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #24292f;background-color: #f6f8fa\">result</span><span style=\"color: #24292f;background-color: #f6f8fa\">;</span>\n</div><div class='code-line code-line-41'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">bytes</span>&nbsp;<span style=\"color: #0550ae\">+=</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">chunk</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #24292f;background-color: #f6f8fa\">length</span><span style=\"color: #24292f;background-color: #f6f8fa\">;</span>\n</div><div class='code-line code-line-42'>\n</div><div class='code-line code-line-43'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">chunks</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">push</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #24292f;background-color: #f6f8fa\">chunk</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-44'>\n</div><div class='code-line code-line-45'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">progress</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">html</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #24292f;background-color: #f6f8fa\">chunks</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #24292f;background-color: #f6f8fa\">length</span>&nbsp;<span style=\"color: #0550ae\">+</span>&nbsp;<span style=\"color: #0a3069\">'</span><span style=\"color: #0a3069\"> chunks // </span><span style=\"color: #0a3069\">'</span>&nbsp;<span style=\"color: #0550ae\">+</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">bytes</span>&nbsp;<span style=\"color: #0550ae\">+</span>&nbsp;<span style=\"color: #0a3069\">'</span><span style=\"color: #0a3069\"> bytes...</span><span style=\"color: #0a3069\">'</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-46'>\n</div><div class='code-line code-line-47'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">if</span><span style=\"color: #24292f;background-color: #f6f8fa\">((</span><span style=\"color: #24292f;background-color: #f6f8fa\">offset</span>&nbsp;<span style=\"color: #0550ae\">&lt;</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">size</span><span style=\"color: #24292f;background-color: #f6f8fa\">)){</span>\n</div><div class='code-line code-line-48'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">offset</span>&nbsp;<span style=\"color: #0550ae\">+=</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">chunk_size</span><span style=\"color: #24292f;background-color: #f6f8fa\">;</span>\n</div><div class='code-line code-line-49'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">blob</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">file</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">slice</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #24292f;background-color: #f6f8fa\">offset</span><span style=\"color: #24292f;background-color: #f6f8fa\">,</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">offset</span>&nbsp;<span style=\"color: #0550ae\">+</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">chunk_size</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-50'>\n</div><div class='code-line code-line-51'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">reader</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">readAsText</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #24292f;background-color: #f6f8fa\">blob</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-52'>\n</div><div class='code-line code-line-53'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">}</span>&nbsp;<span style=\"color: #cf222e\">else</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">{</span>\n</div><div class='code-line code-line-54'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">progress</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">html</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #0a3069\">\"</span><span style=\"color: #0a3069\">processing teh content...</span><span style=\"color: #0a3069\">\"</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-55'>\n</div><div class='code-line code-line-56'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">content</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">chunks</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">join</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #0a3069\">\"\"</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-57'>\n</div><div class='code-line code-line-58'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #8250df\">alert</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #0a3069\">\"</span><span style=\"color: #0a3069\">content is ready!</span><span style=\"color: #0a3069\">\"</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-59'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">debugger</span><span style=\"color: #24292f;background-color: #f6f8fa\">;</span>\n</div><div class='code-line code-line-60'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">};</span>\n</div><div class='code-line code-line-61'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">}</span>\n</div><div class='code-line code-line-62'>\n</div><div class='code-line code-line-63'>\n</div><div class='code-line code-line-64'>\n</div><div class='code-line code-line-65'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">};</span>\n</div><div class='code-line code-line-66'>\n</div><div class='code-line code-line-67'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #cf222e\">var</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">blob</span>&nbsp;<span style=\"color: #0550ae\">=</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">file</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">slice</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #24292f;background-color: #f6f8fa\">offset</span><span style=\"color: #24292f;background-color: #f6f8fa\">,</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">offset</span>&nbsp;<span style=\"color: #0550ae\">+</span>&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">chunk_size</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-68'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">reader</span><span style=\"color: #24292f;background-color: #f6f8fa\">.</span><span style=\"color: #8250df\">readAsText</span><span style=\"color: #24292f;background-color: #f6f8fa\">(</span><span style=\"color: #24292f;background-color: #f6f8fa\">blob</span><span style=\"color: #24292f;background-color: #f6f8fa\">);</span>\n</div><div class='code-line code-line-69'>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">}</span>\n</div><div class='code-line code-line-70'>&nbsp;&nbsp;<span style=\"color: #24292f;background-color: #f6f8fa\">});</span>\n</div><div class='code-line code-line-71'><span style=\"color: #116329\">&lt;/script&gt;</span>\n</div><div class='code-line code-line-72'>\n</div><div class='code-line code-line-73'>\n</div><div class='code-line code-line-74'>\n</div></code></div>\n\n<p>ref: <a href=\"https://gist.github.com/4394394\" target=\"_blank\">https://gist.github.com/4394394</a></p>\n\n</div>\n",
      "assets": {},
      "_meta": {
        "identifier": "dojo4/processing-huge-files-with-an-html5-file-input",
        "type": "dojo4",
        "id": "processing-huge-files-with-an-html5-file-input",
        "urls": [
          "/ro/dojo4/processing-huge-files-with-an-html5-file-input/body.md"
        ],
        "created_at": "2025-05-06 08:47:14 +0000",
        "updated_at": "2025-05-06 08:47:14 +0000",
        "rel": {
          "curr": "dojo4/processing-huge-files-with-an-html5-file-input",
          "prev": "dojo4/testing-ie9-is-less-like-eating-glass-than-before",
          "next": "dojo4/disaster"
        }
      }
    }
  },
  "_meta": {
    "url": "/ro",
    "type": "dojo4",
    "id": "processing-huge-files-with-an-html5-file-input"
  }
}